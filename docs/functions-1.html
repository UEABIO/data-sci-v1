<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Functions | 5023Y</title>
<meta name="author" content="Philip T. Leftwich">
<meta name="description" content="Today's workshop can be carried out in any R project.  Why not try and set up a project on Github and open it on RStudio Cloud?  First - go to (https://github.com) and log in.  Near repositories...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 9 Functions | 5023Y">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ueabio.github.io/data-sci/functions-1.html">
<meta property="og:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<meta property="og:description" content="Today's workshop can be carried out in any R project.  Why not try and set up a project on Github and open it on RStudio Cloud?  First - go to (https://github.com) and log in.  Near repositories...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Functions | 5023Y">
<meta name="twitter:description" content="Today's workshop can be carried out in any R project.  Why not try and set up a project on Github and open it on RStudio Cloud?  First - go to (https://github.com) and log in.  Near repositories...">
<meta name="twitter:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/font-awesome-5.13.0/js/script.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script language="javascript"> 
        function toggle(id) {
            var ele = document.getElementById("toggleText" + id);
            var text = document.getElementById("displayText" + id);
            var buttonText = text.innerHTML.replace("Show ", "");
            buttonText = buttonText.replace("Hide ", "");
            if(ele.style.display == "block") {
                ele.style.display = "none";
                text.innerHTML = "Show " + buttonText;
            } else {
                ele.style.display = "block";
                text.innerHTML = "Hide " + buttonText;
            }
        } 
    </script><script language="javascript">
        function openCode(evt, codeName, id) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent" + id);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks" + id);
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(codeName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script><script language="javascript">
        function hide(id){
            document.getElementById(id).style.display = "none";
        }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Data Science for Biologists">5023Y</a>:
        <small class="text-muted">Data Science for Biologists</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Get Started in R</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics</a></li>
<li class="book-part">Exploring Data</li>
<li><a class="" href="loading-data.html"><span class="header-section-number">3</span> Loading data</a></li>
<li><a class="" href="data-wrangling-part-one.html"><span class="header-section-number">4</span> Data wrangling part one</a></li>
<li><a class="" href="data-wrangling-part-two.html"><span class="header-section-number">5</span> Data wrangling part two</a></li>
<li><a class="" href="data-visualisation-with-ggplot2.html"><span class="header-section-number">6</span> Data visualisation with ggplot2</a></li>
<li class="book-part">Literate Programming and Reproducibility</li>
<li><a class="" href="markdown.html"><span class="header-section-number">7</span> Markdown</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Github</a></li>
<li class="book-part">R Programming</li>
<li><a class="active" href="functions-1.html"><span class="header-section-number">9</span> Functions</a></li>
<li class="book-part">Advanced Data Insights</li>
<li><a class="" href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></li>
<li><a class="" href="data-insights-part-two.html"><span class="header-section-number">11</span> Data insights part two</a></li>
<li class="book-part">Statistics</li>
<li><a class="" href="introduction-to-statistics.html"><span class="header-section-number">12</span> Introduction to statistics</a></li>
<li><a class="" href="introduction-to-linear-models.html"><span class="header-section-number">13</span> Introduction to Linear Models</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">14</span> Testing</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">15</span> Regression</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">16</span> ANOVA</a></li>
<li><a class="" href="multivariate-linear-models.html"><span class="header-section-number">17</span> Multivariate linear models</a></li>
<li><a class="" href="complex-models.html"><span class="header-section-number">18</span> Complex models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">19</span> Generalized Linear Models</a></li>
<li class="book-part">Advanced topics</li>
<li><a class="" href="mixed-models.html"><span class="header-section-number">20</span> Mixed models</a></li>
<li><a class="" href="generalised-additive-models.html"><span class="header-section-number">21</span> Generalised Additive Models</a></li>
<li><a class="" href="survival-models.html"><span class="header-section-number">22</span> Survival models</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">23</span> Unsupervised Machine Learning</a></li>
<li><a class="" href="power-analysis.html"><span class="header-section-number">24</span> Power analysis</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">25</span> Iteration</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="updating-r-rstudio-and-packages.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="exporting-files-from-the-server.html"><span class="header-section-number">C</span> Exporting files from the server</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">D</span> Symbols</a></li>
<li><a class="" href="baser.html"><span class="header-section-number">E</span> Base R vs. Tidyverse</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/UEABIO/data-sci-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="functions-1" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Functions<a class="anchor" aria-label="anchor" href="#functions-1"><i class="fas fa-link"></i></a>
</h1>
<div class="try">
<p>
Today's workshop can be carried out in any R project.
</p>
<p>
Why not try and set up a project on Github and open it on RStudio Cloud?
</p>
<p>
First - go to (<a href="https://github.com" class="uri">https://github.com</a>) and log in.
</p>
<p>
Near repositories click the big green "New" button.
</p>
<p>
Set it to no template, give it a name like "Learning R functions".
</p>
<p>
Initialise the project with a README and create repository
</p>
<p>
Click on the green "Code" button to get the link to Clone the repository into RStudio Cloud.
</p>
</div>
<p>Most of the time when we work in R, we will use functions; often pre-written functions that we access from baseR or installed packages. But you can also write your own functions. Eventually you could even turn a collection of your own functions into a package (for yourself or others).</p>
<p><strong>Functions</strong> make it easy to use sets of code instructions repeatedly (without filling our scripts with the code underlying the function) and help us carry out multiple tasks in a single step without having to go through the details of how the steps are executed.</p>
<div id="structuring-a-function" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Structuring a function<a class="anchor" aria-label="anchor" href="#structuring-a-function"><i class="fas fa-link"></i></a>
</h2>
<p>R makes it easy to create user defined functions by using <code>function()</code>. Here is how it works:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">my_args</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># code to run</span>
  <span class="co"># return (some value)</span>
<span class="op">}</span></code></pre></div>
<ul>
<li><p>Give your function an object name and assign the function to it, e.g. <code>my_function_name &lt;- function()</code>.</p></li>
<li><p>Within the parentheses you specify inputs and arguments just like how pre-written functions work, e.g. <code>function(my_args)</code>.</p></li>
<li><p>Next, put all the code you want your function to execute inside curly brackets like this: <code>function(my_args) {code to run}</code></p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> to specify what you want to your function to output once it is done running the code.</p></li>
</ul>
</div>
<div id="activity-1-understand-the-function" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Activity 1: Understand the function<a class="anchor" aria-label="anchor" href="#activity-1-understand-the-function"><i class="fas fa-link"></i></a>
</h2>
<p>Here is a very simple function. Can you guess what it does?</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_one</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">input_data</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_one</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>What value did you get when running the function above? <input class="webex-solveme nospaces" size="2" data-answer='["11"]'></p>
<p>Now try applying your function to this vector:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">number_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>You should see it worked on <em>each element</em> inside the vector. This emphasises that R is a vector based language (it will by default apply functions on all elements in an object).</p>
</div>
<div id="activity-2-write-your-own-function" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Activity 2: Write your own function:<a class="anchor" aria-label="anchor" href="#activity-2-write-your-own-function"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>I’ve started writing a function for you that will square values, sum them and divide by <code>n-1</code>. To take the square root, we use the <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code> function.</p></li>
<li><p>Complete this function by filling in input_data for the <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code>, and then filling in the remaining empty parentheses with the appropriate object names.</p></li>
<li><p>Now test your function on the <code>number_series</code> vector (or any other vector you like).</p></li>
</ul>
<p>What is the function retruning when applied to a vector? <select class="webex-select"><option value="blank"></option>
<option value="">standard deviation</option>
<option value="answer">variance</option>
<option value="">sum of squares</option></select></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Finish writing the function below
</div>
</div>
<pre><code>
# Use the instructions above to complete the function below
variance &lt;- function(input_data){
  square &lt;- sqrt(__)
  ss &lt;- sum(__)
  variance &lt;- (__/(length(__)-1))
  return(__)
}

# Use vector (or make a new one) and try out your new function


variance(number_series)
</code></pre>
<button id="displayTextunnamed-chunk-9" onclick="javascript:toggle('unnamed-chunk-9');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-9" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">variance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span><span class="op">{</span>
     <span class="va">square</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span>
     <span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">square</span><span class="op">)</span>
     <span class="va">variance</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ss</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">input_data</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">variance</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
<div class="info">
<p>
A general rule of thumb. If you end up repeating a line of code more than three times in a script - you should write a function to do the work instead. And write clear comments on its use!
</p>
<p>
Why?
</p>
<p>
It reduces the numbers of lines of code in your script, it reduces the amount of repetition in the code, if you need to make changes you can change the function without having to hunt through all of your code.
</p>
<p>
A really good way to organise your functions is to organise them into a separate script to the rest of your analysis. Write functions in a separate script and use source("scripts/functions.R")
</p>
</div>
</div>
<div id="argument-defaults" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Argument defaults<a class="anchor" aria-label="anchor" href="#argument-defaults"><i class="fas fa-link"></i></a>
</h2>
<p>This is an example of a very simple function that just prints the string "Hello World" whenever you type the function <code>say_hello()</code></p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">say_hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hello World"</span><span class="op">)</span> 
<span class="op">}</span>

<span class="fu">say_hello</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Hello World"</code></pre>
<div id="activity-3-understand-arguments" class="section level3" number="9.4.1">
<h3>
<span class="header-section-number">9.4.1</span> Activity 3: Understand arguments<a class="anchor" aria-label="anchor" href="#activity-3-understand-arguments"><i class="fas fa-link"></i></a>
</h3>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p>What happens when you try to put something in the brackets when <strong>using</strong> this function?</p>
e.g. say_hello("Phil")
</div>
</div>
<button id="displayTextunnamed-chunk-13" onclick="javascript:toggle('unnamed-chunk-13');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-13" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
Error in say_hello( or something similar, this function has not been set with any arguments, therefore it doesn't know what to do with any values provided to it.
</div>
</div>
</div>
<p>Now lets try a similar function, but we include an argument:</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">say_morning</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Good morning"</span>, <span class="va">x</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#  what about this one?</span>
<span class="fu">say_morning</span><span class="op">(</span><span class="st">"Phil"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Good morning Phil"</code></pre>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
What happens when you DO NOT put something in the brackets when using this function?
</div>
</div>
<button id="displayTextunnamed-chunk-16" onclick="javascript:toggle('unnamed-chunk-16');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-16" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="functions-1.html#cb222-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">paste</span>(<span class="st">"Good morning"</span>, x) <span class="sc">:</span> </span>
<span id="cb222-2"><a href="functions-1.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  argument <span class="st">"x"</span> is missing, with no default</span></code></pre></div>
</div>
</div>
</div>
<p>So that was an example where we included an argument for our function. But now it requires a value be provided in order to work.</p>
<div id="argument-defaults-1" class="section level4" number="9.4.1.1">
<h4>
<span class="header-section-number">9.4.1.1</span> Argument defaults<a class="anchor" aria-label="anchor" href="#argument-defaults-1"><i class="fas fa-link"></i></a>
</h4>
<p>However, you are probably used to the idea that many functions have "default" values for arguments, and we can easily set these.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">say_morning_default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span> <span class="op">=</span> <span class="st">"you"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Good morning"</span>, <span class="va">name</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">say_morning_default</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Good morning you"</code></pre>
<div class="try">
<p>
There is now a default value supplied to the argument, but this should still be able to changed when running the function. Try it!
</p>
</div>
</div>
</div>
</div>
<div id="conditonal-functions" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Conditonal functions<a class="anchor" aria-label="anchor" href="#conditonal-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Let's make a function that reports p-values in APA format (with "p = [rounded value]" when p &gt;= .001 and "p &lt; .001" when p &lt; .001).</p>
<p>You can add a default value to any argument. If that argument is skipped, then the function uses the default argument.</p>
<p>First we could make a function that rounds any value to three digits.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">roundp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span>
    <span class="va">reported</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="va">roundp</span><span class="op">)</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">reported</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>But we would like this to have a conditional response as well: so we need and <code>if</code> <code>else</code> statement (or <code>if_else</code>)</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Can you write this function? to print the statements required above?
</div>
</div>
<button id="displayTextunnamed-chunk-21" onclick="javascript:toggle('unnamed-chunk-21');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-21" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="tab">
<button class="tablinksunnamed-chunk-21 active" onclick="javascript:openCode(event, 'option1unnamed-chunk-21', 'unnamed-chunk-21');">
Base R
</button>
<button class="tablinksunnamed-chunk-21" onclick="javascript:openCode(event, 'option2unnamed-chunk-21', 'unnamed-chunk-21');">
<tt>tidyverse</tt>
</button>
</div>
<div id="option1unnamed-chunk-21" class="tabcontentunnamed-chunk-21">
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">reported</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">0.001</span>,
             <span class="st">"p &lt; 0.001"</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
     
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">reported</span><span class="op">)</span>
 <span class="op">}</span></code></pre></div>
</div>
<div id="option2unnamed-chunk-21" class="tabcontentunnamed-chunk-21">
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">.001</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">reported</span> <span class="op">=</span> <span class="st">"p &lt; .001"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">roundp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span>
    <span class="va">reported</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="va">roundp</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">reported</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<script> javascript:hide('option2unnamed-chunk-21') </script>
</div>
</div>
</div>
</div>
<div id="scope" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> Scope<a class="anchor" aria-label="anchor" href="#scope"><i class="fas fa-link"></i></a>
</h2>
<p>Note that any objects created <em>inside</em> a function, stay in the function. So it is possible to have variables with the same name (one inside a function, one in the R environment). Changing the values of one will have <strong>no effect</strong> on the other.</p>
</div>
<div id="warnings-and-errors" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Warnings and errors<a class="anchor" aria-label="anchor" href="#warnings-and-errors"><i class="fas fa-link"></i></a>
</h2>
<div class="try">
<p>
What happens when omit an argument for p, set the value to 1.5 or a character "a"?
</p>
</div>
<p>Sometimes the function will not run, in the first example because we did not provide an argument default.</p>
<p>For <code>p = 1.5</code> it probably <em>shouldn't</em> run (p = 1.5 makes no sense), but it does!</p>
<p>For <code>p = "a"</code> there is a warning but perhaps not a very intuitive one.</p>
<p>We can make our own custom/specific warnings, try this and run it with the arguments above again!</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
   
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"p must be a number"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"p-values cannot less 0"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"p-values cannot be greater than 1"</span><span class="op">)</span>
   
     <span class="va">reported</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">0.001</span>,
             <span class="st">"p &lt; 0.001"</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">reported</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="anonymous-functions" class="section level2" number="9.8">
<h2>
<span class="header-section-number">9.8</span> Anonymous functions<a class="anchor" aria-label="anchor" href="#anonymous-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Anonymous functions are ones where the function definiton is not bound to an R object. That is the function may be created and used but never assigned to a variable. We don't normally encounter these out in the "wild", but may be quite common when used with Iteration (see next chapter).</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">function</span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">input_data</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="activity-3-stretch-exercise" class="section level2" number="9.9">
<h2>
<span class="header-section-number">9.9</span> Activity 3 : Stretch Exercise<a class="anchor" aria-label="anchor" href="#activity-3-stretch-exercise"><i class="fas fa-link"></i></a>
</h2>
<p>We are going to try and write a custom function called <code>find_largest_male()</code>, it will be used to identify the largest male <em>Drosophila</em> from a small dataset.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make some fake data into a tibble</span>

<span class="va">vial</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">sex</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"male"</span>,<span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">weight_mg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">0.2</span>, sd<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">0.21</span>, sd<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>

<span class="va">dros_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">vial</span>, <span class="va">sex</span>, <span class="va">weight_mg</span><span class="op">)</span></code></pre></div>
<div id="step-1." class="section level4" number="9.9.0.1">
<h4>
<span class="header-section-number">9.9.0.1</span> Step 1.<a class="anchor" aria-label="anchor" href="#step-1."><i class="fas fa-link"></i></a>
</h4>
<p>What functions would you use to extract the heaviest male from this dataset? Try and think that through first.</p>
<button id="displayTextunnamed-chunk-26" onclick="javascript:toggle('unnamed-chunk-26');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-26" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">dros_weight</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">weight_mg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">.</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
vial
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
weight_mg
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
0.2444658
</td>
</tr></tbody>
</table></div>
</div>
</div>
</div>
</div>
</div>
<div id="step-2." class="section level4" number="9.9.0.2">
<h4>
<span class="header-section-number">9.9.0.2</span> Step 2.<a class="anchor" aria-label="anchor" href="#step-2."><i class="fas fa-link"></i></a>
</h4>
<p>Abstract your lines of code to make a function. How could you remove the data and introduce a placeholder instead?</p>
<button id="displayTextunnamed-chunk-27" onclick="javascript:toggle('unnamed-chunk-27');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-27" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">find_largest_male</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span> 
  <span class="va">df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">weight_mg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">.</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="step-3." class="section level4" number="9.9.0.3">
<h4>
<span class="header-section-number">9.9.0.3</span> Step 3.<a class="anchor" aria-label="anchor" href="#step-3."><i class="fas fa-link"></i></a>
</h4>
<p>Now we have a basic function we can work to refine and extend it.</p>
<p>What if we made a function that could pick the largest Drosophila overall, or filter by male or female depending on what we need?</p>
<p>Could we extend it to return more than one value if requested?</p>
<p>To make an argument except more than one value as the potential default at once use <code><a href="https://rdrr.io/r/base/c.html">c("male", "female")</a></code></p>
<button id="displayTextunnamed-chunk-28" onclick="javascript:toggle('unnamed-chunk-28');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-28" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">find_largest_fly</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,  <span class="va">n</span><span class="op">=</span><span class="fl">1</span>, <span class="va">s</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span> <span class="op">)</span><span class="op">{</span> 
  <span class="va">df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="va">s</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">weight_mg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">.</span>, n<span class="op">=</span><span class="va">n</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="step-4.-stretch-exercise" class="section level4" number="9.9.0.4">
<h4>
<span class="header-section-number">9.9.0.4</span> Step 4. Stretch exercise<a class="anchor" aria-label="anchor" href="#step-4.-stretch-exercise"><i class="fas fa-link"></i></a>
</h4>
<p>Can you add any useful warning messages? Perhaps if a fruitfly weight is above 0.4mg that this is an unusual value? Or warnings against the wrong types of data being supplied <code>is.numeric</code>?</p>
</div>
</div>
<div id="activity-4-custom-ggplot-themes" class="section level2" number="9.10">
<h2>
<span class="header-section-number">9.10</span> Activity 4: Custom ggplot themes<a class="anchor" aria-label="anchor" href="#activity-4-custom-ggplot-themes"><i class="fas fa-link"></i></a>
</h2>
<p>It is often the case that we start to default to a particular 'style' for our figures, or you may be making several similar figures within a research paper. Creating custom functions can extend to making our own custom ggplot themes. You have probably already used theme variants such as <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code> - these are incredibly useful, but you might find you still wish to make consistent changes.</p>
<p>Here is a plot we can make with the <code>dros_weight</code> tibble:</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">dros_weight</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sex</span>,
         y<span class="op">=</span><span class="va">weight_mg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="va">plot</span></code></pre></div>
<div class="inline-figure"><img src="09-writing-functions_files/figure-html/unnamed-chunk-29-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>With the addition of a title and <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic()</a></code> we can improve the style quickly</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Comparison of weights (mg) between \nmale and female Drosophila"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-writing-functions_files/figure-html/unnamed-chunk-30-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>But I <strong>still</strong> want to make some more changes, rather than do this work for one figure, and potentially have to repeat this several times for subsequent figures, I can decide to make a new function instead. See <a href="https://ggplot2.tidyverse.org/reference/theme.html">here</a> for a full breakdown of the arguments for the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function.</p>
<div class="info">
<p>
Note when using a pre-set theme, and then modifying it further, it is important to get the order of syntax correct e.g
</p>
<p>
theme_classic + theme() # is correct
</p>
<p>
theme() + theme_classic() # will not work as intended
</p>
</div>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># custom theme sets defaults for font and size, but these can be changed without changing the function</span>
<span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_size</span><span class="op">=</span><span class="fl">12</span>, <span class="va">base_family</span><span class="op">=</span><span class="st">"serif"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_size</span>, 
                base_family <span class="op">=</span> <span class="va">base_family</span>,
                <span class="op">)</span> <span class="op">+</span>
<span class="co"># update theme minimal </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
  <span class="co"># specify default settings for plot titles - use rel to set titles relative to base size</span>
  plot.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span>,
      face<span class="op">=</span><span class="st">"bold"</span>,
      family<span class="op">=</span><span class="va">base_family</span><span class="op">)</span>,
  <span class="co">#specify defaults for axis titles</span>
  axis.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>
    size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
    family<span class="op">=</span><span class="va">base_family</span><span class="op">)</span>,
  <span class="co"># specify position for y axis title</span>
  axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fl">10</span>, l<span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,
  <span class="co"># specify position for x axis title</span>
  axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span> t <span class="op">=</span> <span class="fl">10</span>, b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,
  <span class="co"># set major y grid lines</span>
  panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"gray"</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,
  <span class="co"># add axis lines</span>
  axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span><span class="op">)</span>,
   <span class="co"># Adding a 0.5cm margin around the plot</span>
  plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, units <span class="op">=</span> , <span class="st">"cm"</span><span class="op">)</span>,    
   <span class="co"># Setting the font for the legend text</span>
  legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>,   
    <span class="co"># Removing the legend title</span>
          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,    
   <span class="co"># Setting the position for the legend - 0 is left/bottom, 1 is top/right</span>
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span><span class="op">)</span>             
<span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<p>With this function set, I can now use it for as many figures as I wish. To use it in the future I should probably save it in a unique script, with a clear title and comments for future use.</p>
<p>I could then easily use <code><a href="https://rdrr.io/r/base/source.html">source("custom_theme_function.R")</a></code> to make this available to any scripts I was using.</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot</span><span class="op">+</span>
<span class="fu">theme_custom</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-writing-functions_files/figure-html/unnamed-chunk-33-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="info">
<p>
Functions are about 'abstracting' a command, so it can be used more than once. If you are having trouble writing a function, start by writing a standard set of commands as you would to solve a specific problem. Then work backwards to turn this into a function.
</p>
</div>
</div>
<div id="writing-packages" class="section level2" number="9.11">
<h2>
<span class="header-section-number">9.11</span> Writing Packages<a class="anchor" aria-label="anchor" href="#writing-packages"><i class="fas fa-link"></i></a>
</h2>
<p>You should be familiar by now with the idea that R packages add data and functions to your workspace. They are bundles of code that anyone can write, most commonly you will be downloading packages from CRAN. However development stage packages can also be downloaded directly from GitHub.</p>
<p>In the previous section we walked through some very basic writing of new functions. We can save these as R scripts and move them from project to project. Or we could choose to write them into a documented R package.
<a href="https://ourcodingclub.github.io/tutorials/writing-r-package/">This tutorial</a> shows you just how to do that. Writing packages is a useful thing to do, even if you think the only person that will ever use them is yourself, as you then more easily access these functions across different workspaces and projects.</p>
</div>
<div id="resources" class="section level2" number="9.12">
<h2>
<span class="header-section-number">9.12</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://r4ds.had.co.nz/functions.html">R4DS: Functions</a></li>
</ul>
</div>
</div>



<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="github.html"><span class="header-section-number">8</span> Github</a></div>
<div class="next"><a href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions-1"><span class="header-section-number">9</span> Functions</a></li>
<li><a class="nav-link" href="#structuring-a-function"><span class="header-section-number">9.1</span> Structuring a function</a></li>
<li><a class="nav-link" href="#activity-1-understand-the-function"><span class="header-section-number">9.2</span> Activity 1: Understand the function</a></li>
<li><a class="nav-link" href="#activity-2-write-your-own-function"><span class="header-section-number">9.3</span> Activity 2: Write your own function:</a></li>
<li>
<a class="nav-link" href="#argument-defaults"><span class="header-section-number">9.4</span> Argument defaults</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#activity-3-understand-arguments"><span class="header-section-number">9.4.1</span> Activity 3: Understand arguments</a></li></ul>
</li>
<li><a class="nav-link" href="#conditonal-functions"><span class="header-section-number">9.5</span> Conditonal functions</a></li>
<li><a class="nav-link" href="#scope"><span class="header-section-number">9.6</span> Scope</a></li>
<li><a class="nav-link" href="#warnings-and-errors"><span class="header-section-number">9.7</span> Warnings and errors</a></li>
<li><a class="nav-link" href="#anonymous-functions"><span class="header-section-number">9.8</span> Anonymous functions</a></li>
<li><a class="nav-link" href="#activity-3-stretch-exercise"><span class="header-section-number">9.9</span> Activity 3 : Stretch Exercise</a></li>
<li><a class="nav-link" href="#activity-4-custom-ggplot-themes"><span class="header-section-number">9.10</span> Activity 4: Custom ggplot themes</a></li>
<li><a class="nav-link" href="#writing-packages"><span class="header-section-number">9.11</span> Writing Packages</a></li>
<li><a class="nav-link" href="#resources"><span class="header-section-number">9.12</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/UEABIO/data-sci-v1/blob/main/book/09-writing-functions.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/UEABIO/data-sci-v1/edit/main/book/09-writing-functions.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>5023Y</strong>: Data Science for Biologists" was written by Philip T. Leftwich. It was last built on 2023-02-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
