<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Data wrangling part two | 5023Y</title>
<meta name="author" content="Philip T. Leftwich">
<meta name="description" content="5.1 Load your workspace You should have a workspace ready to work with the Palmer penguins data. Load this workspace now. Think about some basic checks before you start your work today.  5.1.1...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 5 Data wrangling part two | 5023Y">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ueabio.github.io/data-sci/data-wrangling-part-two.html">
<meta property="og:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<meta property="og:description" content="5.1 Load your workspace You should have a workspace ready to work with the Palmer penguins data. Load this workspace now. Think about some basic checks before you start your work today.  5.1.1...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Data wrangling part two | 5023Y">
<meta name="twitter:description" content="5.1 Load your workspace You should have a workspace ready to work with the Palmer penguins data. Load this workspace now. Think about some basic checks before you start your work today.  5.1.1...">
<meta name="twitter:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/font-awesome-5.13.0/js/script.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script language="javascript"> 
        function toggle(id) {
            var ele = document.getElementById("toggleText" + id);
            var text = document.getElementById("displayText" + id);
            var buttonText = text.innerHTML.replace("Show ", "");
            buttonText = buttonText.replace("Hide ", "");
            if(ele.style.display == "block") {
                ele.style.display = "none";
                text.innerHTML = "Show " + buttonText;
            } else {
                ele.style.display = "block";
                text.innerHTML = "Hide " + buttonText;
            }
        } 
    </script><script language="javascript">
        function openCode(evt, codeName, id) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent" + id);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks" + id);
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(codeName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script><script language="javascript">
        function hide(id){
            document.getElementById(id).style.display = "none";
        }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Data Science for Biologists">5023Y</a>:
        <small class="text-muted">Data Science for Biologists</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Get Started in R</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics</a></li>
<li class="book-part">Exploring Data</li>
<li><a class="" href="loading-data.html"><span class="header-section-number">3</span> Loading data</a></li>
<li><a class="" href="data-wrangling-part-one.html"><span class="header-section-number">4</span> Data wrangling part one</a></li>
<li><a class="active" href="data-wrangling-part-two.html"><span class="header-section-number">5</span> Data wrangling part two</a></li>
<li><a class="" href="data-visualisation-with-ggplot2.html"><span class="header-section-number">6</span> Data visualisation with ggplot2</a></li>
<li class="book-part">Literate Programming and Reproducibility</li>
<li><a class="" href="markdown.html"><span class="header-section-number">7</span> Markdown</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Github</a></li>
<li class="book-part">R Programming</li>
<li><a class="" href="functions-1.html"><span class="header-section-number">9</span> Functions</a></li>
<li class="book-part">Advanced Data Insights</li>
<li><a class="" href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></li>
<li><a class="" href="data-insights-part-two.html"><span class="header-section-number">11</span> Data insights part two</a></li>
<li class="book-part">Statistics</li>
<li><a class="" href="introduction-to-statistics.html"><span class="header-section-number">12</span> Introduction to statistics</a></li>
<li><a class="" href="introduction-to-linear-models.html"><span class="header-section-number">13</span> Introduction to Linear Models</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">14</span> Testing</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">15</span> Regression</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">16</span> ANOVA</a></li>
<li><a class="" href="multivariate-linear-models.html"><span class="header-section-number">17</span> Multivariate linear models</a></li>
<li><a class="" href="complex-models.html"><span class="header-section-number">18</span> Complex models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">19</span> Generalized Linear Models</a></li>
<li class="book-part">Advanced topics</li>
<li><a class="" href="mixed-models.html"><span class="header-section-number">20</span> Mixed models</a></li>
<li><a class="" href="generalised-additive-models.html"><span class="header-section-number">21</span> Generalised Additive Models</a></li>
<li><a class="" href="survival-models.html"><span class="header-section-number">22</span> Survival models</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">23</span> Unsupervised Machine Learning</a></li>
<li><a class="" href="power-analysis.html"><span class="header-section-number">24</span> Power analysis</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">25</span> Iteration</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="updating-r-rstudio-and-packages.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="exporting-files-from-the-server.html"><span class="header-section-number">C</span> Exporting files from the server</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">D</span> Symbols</a></li>
<li><a class="" href="baser.html"><span class="header-section-number">E</span> Base R vs. Tidyverse</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/UEABIO/data-sci-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-wrangling-part-two" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Data wrangling part two<a class="anchor" aria-label="anchor" href="#data-wrangling-part-two"><i class="fas fa-link"></i></a>
</h1>
<div id="load-your-workspace-1" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Load your workspace<a class="anchor" aria-label="anchor" href="#load-your-workspace-1"><i class="fas fa-link"></i></a>
</h2>
<p>You should have a workspace ready to work with the Palmer penguins data. Load this workspace now.</p>
<p>Think about some basic checks before you start your work today.</p>
<div id="checklist-1" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> Checklist<a class="anchor" aria-label="anchor" href="#checklist-1"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Are there objects already in your Environment pane? <a href="r-basics.html#global-options">There shouldn't be</a>, if there are use <code><a href="https://rdrr.io/r/base/rm.html">rm(list=ls())</a></code></p></li>
<li><p>Re-run your script from <a href="data-wrangling-part-one.html#data-wrangling-part-one">last time</a> from line 1 to the last line</p></li>
<li><p>Check for any warning or error messages</p></li>
<li><p>Add the code from today's session to your script as we go</p></li>
</ul>
</div>
</div>
<div id="more-summary-tools" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> More summary tools<a class="anchor" aria-label="anchor" href="#more-summary-tools"><i class="fas fa-link"></i></a>
</h2>
<p>Very often we want to make calculations aobut groups of observations, such as the mean or median. We are often interested in comparing responses among groups. For example, we previously found the number of distinct penguins in our entire dataset.</p>
<div class="try">
<p>
Add these new lines of code to your script as you try them. Comment out # and add short descriptions of what you are achieving with them
</p>
</div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now consider when the groups are subsets of observations, as when we find out the number of penguins in each species and sex.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As we progress, not only are we learning how to use our data wrangling tools. We are also gaining insights into our data.</p>
<p><strong>Question</strong> How many female Adelie penguins are in our dataset?</p>
<p><input class="webex-solveme nospaces" size="2" data-answer='["65"]'></p>
<p><br></p>
<p><strong>Question</strong> How many Gentoo penguins <strong>did not</strong> have their sex recorded?</p>
<p><input class="webex-solveme nospaces" size="1" data-answer='["5"]'></p>
<p><br></p>
<p>We are using summarise and group_by a lot! They are very powerful functions:</p>
<ul>
<li><p><code>group_by</code> adds <em>grouping</em> information into a data object, so that subsequent calculations happen on a <em>group-specific</em> basis.</p></li>
<li><p><code>summarise</code> is a data aggregation function thart calculates summaries of one or more variables, and it will do this separately for any groups defined by <code>group_by</code></p></li>
</ul>
<div id="using-summarise" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Using summarise()<a class="anchor" aria-label="anchor" href="#using-summarise"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> has a whole list of useful functions for producing <em>descriptive</em> statistics</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
verb
</th>
<th style="text-align:left;">
action
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
mean(), median()
</td>
<td style="text-align:left;">
Center data
</td>
</tr>
<tr>
<td style="text-align:left;">
sd(), IQR()
</td>
<td style="text-align:left;">
Spread of data
</td>
</tr>
<tr>
<td style="text-align:left;">
min(), max(), quantile()
</td>
<td style="text-align:left;">
Range of data
</td>
</tr>
<tr>
<td style="text-align:left;">
first(), last(), nth()
</td>
<td style="text-align:left;">
Position
</td>
</tr>
<tr>
<td style="text-align:left;">
n(), n_distinct()
</td>
<td style="text-align:left;">
Count
</td>
</tr>
</tbody>
</table></div>
</div>
<ul>
<li><p><code>min</code> and <code>max</code> to calculate minimum and maximum values of a numeric vector</p></li>
<li><p><code>mean</code> and <code>median</code> to calculate averages of a numeric vector</p></li>
<li><p><code>sd</code> and <code>var</code> calculate standard deviation and variance of a numeric vector</p></li>
</ul>
<p>Using <code>summarise</code> we can calculate the mean flipper and bill lengths of our penguins:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    mean_flipper_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
     mean_culmen_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">culmen_length_mm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="info">
<p>
Note - we provide informative names for ourselves on the left side of the <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code>
</p>
<p>
When performing calculations in summarise it is important to set <code>na.rm = TRUE</code>, this removes missing values from the calculation
</p>
</div>
<div class="try">
<p>
What happens when you try to produce calculations that include <code>NA</code>? e.g <code>NA</code> + 4 or <code>NA</code> * 5
</p>
</div>
<p>We can use several functions in <code>summarise</code>. Which means we can string several calculations together in a single step, and generate more insights into our data.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># number of rows of data</span>
            num_penguins <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span>, <span class="co"># number of unique individuals</span>
            mean_flipper_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># mean flipper length</span>
            prop_female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"FEMALE"</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># proportion of observations that are coded as female</span></code></pre></div>
<div class="webex-solution">
<button>
Solution
</button>
<ul>
<li>There are 190 unique IDs and 344 total observations so it would appear that there are roughly twice as many observations as unique individuals. The sex ratio is roughly even (48% female) and the average flipper length is 201 mm.</li>
</ul>
</div>
</div>
<div id="summarize-across-columns" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Summarize <code>across</code> columns<a class="anchor" aria-label="anchor" href="#summarize-across-columns"><i class="fas fa-link"></i></a>
</h3>
<p><code>across</code> has two arguments, <code>.cols</code> and <code>.fns</code>.</p>
<ul>
<li><p>The <code>.cols</code> argument lets you select the columns you wish to apply functions to</p></li>
<li><p>The <code>.fns</code> argument applies the required function to all of the selected columns.</p></li>
</ul>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Across ----</span>
<span class="co"># The mean of ALL numeric columns in the data, where(is.numeric == TRUE) hunts for numeric columns</span>

<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, 
                   .fns <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The above example calculates the means of any &amp; all numeric variables in the dataset.</p>
<p>The below example is a slightly complicated way of running the n_distinct for summarise. The <code>.cols()</code> looks for any column that contains the word "penguin" and then runs the <code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct()</a></code>command on these</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># number of distinct penguins, as only one column contains the word penguin</span>
<span class="co"># the argument contains looks for columns that match a character expression</span>

<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"individual"</span><span class="op">)</span>, 
                   .fns <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="group_by-revisited" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> group_by revisited<a class="anchor" aria-label="anchor" href="#group_by-revisited"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>group_by</code> function provides the ability to separate our summary functions according to any subgroups we wish to make. The real magic happens when we pair this with <code>summarise</code> and <code>mutate</code>.</p>
<p>In this example, by grouping on the individual penguin ids, then summarising by n - we can see how many times each penguin was monitored in the course of this study.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguin_stats</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>num<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="info">
<p>
Remember the actions of <code>group_by</code> are "invisible". Subsequent functions are applied in a "grouped by" manner - but the dataframe itself looks unchanged.
</p>
</div>
</div>
<div id="more-than-one-grouping-variable" class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> More than one grouping variable<a class="anchor" aria-label="anchor" href="#more-than-one-grouping-variable"><i class="fas fa-link"></i></a>
</h3>
<p>What if we need to calculate by more than one variable at a time?
No problem we can submit several arguments:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_grouped</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span></code></pre></div>
<p>We can then calculate the mean flipper length of penguins in each of the six combinations</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_grouped</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_flipper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now the first row of our summary table shows us the mean flipper length (in mm) for female Adelie penguins. There are eight rows in total, six unique combinations and two rows where the sex of the penguins was not recorded(<code>NA</code>)</p>
</div>
<div id="using-group_by-with-mutate" class="section level3" number="5.2.5">
<h3>
<span class="header-section-number">5.2.5</span> using group_by with mutate<a class="anchor" aria-label="anchor" href="#using-group_by-with-mutate"><i class="fas fa-link"></i></a>
</h3>
<p>So far we have only used <code>group_by</code> with the <code>summarise</code> function, but this doesn't always have to be the case.
When <code>mutate</code> is used with <code>group_by</code>, the calculations occur by 'group'. Here's an example:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using mutate and group_by ----</span>
<span class="va">centered_penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_centered <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">centered_penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flipper_centered</span><span class="op">)</span>
<span class="co"># Each row now returns a value for EACH penguin of how much greater/lesser than the group average (sex and species) its flipper is. </span></code></pre></div>
<p>Here we are calculating a <strong>group centered mean</strong>, this new variable contains the <em>difference</em> between each observation and the mean of whichever group that observation is in.</p>
</div>
<div id="remove-group_by" class="section level3" number="5.2.6">
<h3>
<span class="header-section-number">5.2.6</span> remove group_by<a class="anchor" aria-label="anchor" href="#remove-group_by"><i class="fas fa-link"></i></a>
</h3>
<p>On occasion we may need to remove the grouping information from a dataset. This is often required when we string pipes together, when we need to work using a grouping structure, then revert back to the whole dataset again</p>
<p>Look at our grouped dataframe, and we can see the information on groups is at the top of the data:</p>
<pre><code># A tibble: 344 x 10
# Groups:   sex, species [8]
   species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
 1 Adelie  Torge~           39.1          18.7              181        3750
 2 Adelie  Torge~           39.5          17.4              186        3800
 3 Adelie  Torge~           40.3          18                195        3250</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run this command will remove the groups - but this is only saved if assigned BACK to an object</span>

<span class="va">centered_penguins</span> <span class="op">&lt;-</span> <span class="va">centered_penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">centered_penguins</span></code></pre></div>
<p>Look at this output - you can see the information on groups has now been removed from the data.</p>
</div>
</div>
<div id="working-with-character-strings" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Working with character strings<a class="anchor" aria-label="anchor" href="#working-with-character-strings"><i class="fas fa-link"></i></a>
</h2>
<p>Datasets often contain words, and we call these words "(character) strings".</p>
<p>Often these aren't quite how we want them to be, but we can manipulate these as much as we like. Functions in the package <code>stringr</code>, are fantastic. And the number of different types of manipulations are endless!</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Stringr ----</span>

<span class="fu">str_replace_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"e"</span><span class="op">=</span> <span class="st">"E"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># replace all character "e" with "E"</span></code></pre></div>
<div id="more-stringr" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> More stringr<a class="anchor" aria-label="anchor" href="#more-stringr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species<span class="op">=</span><span class="fu">str_to_upper</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Capitalise all letters</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species<span class="op">=</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">species</span>, <span class="st">"e"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># remove every character "e" from selected variables</span></code></pre></div>
<p>We can also trim leading or trailing empty spaces with <code>str_trim</code>. These are often problematic and difficult to spot e.g.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"penguin"</span>, <span class="st">" penguin"</span>, <span class="st">"penguin "</span><span class="op">)</span><span class="op">)</span> 
<span class="va">df2</span> <span class="co"># make a test dataframe</span></code></pre></div>
<p>We can easily imagine a scenario where data is manually input, and trailing or leading spaces are left in. These are difficult to spot by eye - but problematic because as far as R is concerned these are different values. We can use the function <code>distinct</code> to return the names of all the different levels it can find in this dataframe.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If we pipe the data throught the <code>str_trim</code> function to remove any gaps, then pipe this on to <code>distinct</code> again - by removing the whitespace, R now recognises just one level to this data.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu">str_trim</span><span class="op">(</span><span class="va">label</span>, side<span class="op">=</span><span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>A quick example of how to extract partial strings according to a pattern is to use <code>str_detect</code>. Combined with <code>filter</code> it is possible to subset a dataframe by searching for all the strings that match provided information, such as all the penguin IDs that start with "N1"</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">individual_id</span>, <span class="st">"N1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="separate" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> separate<a class="anchor" aria-label="anchor" href="#separate"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes a string might contain two pieces of information in one. This does not confirm to our tidy data principles. But we can easily separate the information with <code>separate()</code> from the <code>tidyr</code> package.</p>
<p>First we produce some made-up data</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a-1"</span>, <span class="st">"a-2"</span>, <span class="st">"a-3"</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#make a one column tibble</span>
<span class="va">df</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
label
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
a-1
</td>
</tr>
<tr>
<td style="text-align:left;">
a-2
</td>
</tr>
<tr>
<td style="text-align:left;">
a-3
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">label</span>, <span class="co"># name of variable</span>
           <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"treatment"</span>, <span class="st">"replicate"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep<span class="op">=</span><span class="st">"-"</span><span class="op">)</span> <span class="co"># the character to mark where the separation occurs</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:left;">
replicate
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
<p>We started with one variable called <code>label</code> and then split it into two variables, <code>treatment</code> and <code>replicate</code>, with the split made where <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> occurs.
The opposite of this function is <code>unite()</code></p>
</div>
</div>
<div id="changing-data-formats" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Changing data formats<a class="anchor" aria-label="anchor" href="#changing-data-formats"><i class="fas fa-link"></i></a>
</h2>
<p>In the previous <a href="@glimpse-check-data-format">worksheet</a>, we used <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> to check the format of each of our variables. One of our variables <code>date_egg</code> isn't in a very helpful format. It has been read as a character string, this means there is no intrinsic order or values attached to the dates. Most likely this has happened because of the "/" symbols. When we have clearly non-numerical symbols in our variables, R will default to treating these as character variables.</p>
<p>Luckily we can fix this using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code>str_remove_all()</code></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Remove the all the "/" elements from the <code>date_egg</code> variable
</div>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<p>Check your code</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># DATES ----</span>
<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_egg <span class="op">=</span> <span class="fu">str_remove_all</span><span class="op">(</span><span class="va">date_egg</span>, <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<p><strong>Question</strong> Does this now mean the <code>date_egg</code> variable is being treated as numeric? <code>r</code></p>
<p><select class="webex-select"><option value="blank"></option>
<option value="">yes</option>
<option value="answer">no</option></select></p>
<div class="webex-solution">
<button>
Explain This Answer
</button>
<p>Data formats are set only when reading the data in for the first time, if we wish to change them, then we need to do so explicitly using mutate()</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add the as.numeric() function</span>
<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_egg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">date_egg</span>, <span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="info">
<p>
There are as.numeric(), as.character(), as.logical() functions to convert data formats, these will only work if there are no "illegal" characters. So you may need to remove these first, as in the examples above.
</p>
</div>
</div>
<p><br></p>
</div>
<div id="working-with-dates" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Working with dates<a class="anchor" aria-label="anchor" href="#working-with-dates"><i class="fas fa-link"></i></a>
</h2>
<p>We now know that we can change data formats easily, but treating date as strictly numeric is problematic, it won't account for number of days in months or number of months in a year.</p>
<p>Additionally there's a lot of different ways to write the same date:</p>
<ul>
<li><p>13-10-2019</p></li>
<li><p>10-13-2019</p></li>
<li><p>13-10-19</p></li>
<li><p>13th Oct 2019</p></li>
<li><p>2019-10-13</p></li>
</ul>
<p>This variability makes it difficult to tell our software how to read the information, luckily we can use the functions in the <code>lubridate</code> package.</p>
<p>Depending on how we interpret the date ordering in a file, we can use <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ydm()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy()</a></code></p>
<ul>
<li>
<strong>Question</strong> What is the appropriate function to use on the <code>date_egg</code> variable?</li>
</ul>
<p><input class="webex-solveme nospaces" size="5" data-answer='["dmy()"]'></p>
<div class="warning">
<p>
If you get a warning that some dates could not be parsed, then you might find the date has been inconsistently entered into the dataset.
</p>
<p>
Pay attention to warning and error messages
</p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_egg_proper <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date_egg</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here we use the <code>mutate</code> function from <code>dplyr</code> to create a <em>new variable</em> called <code>date_egg_proper</code> based on the output of converting the characters in <code>date_egg</code> to date format. The original variable is left intact, if we had specified the "new" variable was also called <code>date_egg</code> then it would have overwritten the original variable.</p>
</div>
<p>Once we have established our date data, we are able to perform calculations. Such as the date range across which our data was collected.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>min_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span>,
            max_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="calculations-with-dates" class="section level3" number="5.5.1">
<h3>
<span class="header-section-number">5.5.1</span> Calculations with dates<a class="anchor" aria-label="anchor" href="#calculations-with-dates"><i class="fas fa-link"></i></a>
</h3>
<p>How many times was each penguin measured, and across what total time period?</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>first_observation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span>, 
            last_observation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span>, 
            study_duration <span class="op">=</span> <span class="va">last_observation</span><span class="op">-</span><span class="va">first_observation</span>, 
            n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Cool we can also convert intervals such as days into weeks, months or years with <code><a href="https://lubridate.tidyverse.org/reference/duration.html">dweeks(1)</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/duration.html">dmonths(1)</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears(1)</a></code>.</p>
<p>As with all cool functions, you should check out the RStudio <a href="https://www.rstudio.com/resources/cheatsheets/">cheat sheet</a> for more information. Date type data is common in datasets, and learning to work with it is a useful skill.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>first_observation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span>, 
            last_observation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_egg_proper</span><span class="op">)</span>, 
            study_duration_years <span class="op">=</span> <span class="op">(</span><span class="va">last_observation</span><span class="op">-</span><span class="va">first_observation</span><span class="op">)</span><span class="op">/</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, 
            n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">study_duration_years</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="factors" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Factors<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h2>
<p>In R, factors are a class of data that allow for <strong>ordered categories</strong> with a fixed set of acceptable values.</p>
<p>Typically, you would convert a column from character or numeric class to a factor if you want to set an intrinsic order to the values (“levels”) so they can be displayed non-alphabetically in plots and tables, or for use in linear model analyses (more on this later).</p>
<p>Another common use of factors is to standardise the legends of plots so they do not fluctuate if certain values are temporarily absent from the data.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_range <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">&lt;=</span> <span class="fl">190</span> <span class="op">~</span> <span class="st">"small"</span>,
                                   <span class="va">flipper_length_mm</span> <span class="op">&gt;</span><span class="fl">190</span> <span class="op">&amp;</span> <span class="va">flipper_length_mm</span> <span class="op">&lt;</span> <span class="fl">213</span> <span class="op">~</span> <span class="st">"medium"</span>,
                                   <span class="va">flipper_length_mm</span> <span class="op">&gt;=</span> <span class="fl">213</span> <span class="op">~</span> <span class="st">"large"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If we make a barplot, the order of the values on the x axis will typically be in alphabetical order for any character data</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_range</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-data-wrangling-part-2_files/figure-html/unnamed-chunk-39-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>To convert a character or numeric column to class factor, you can use any function from the <code>forcats</code> package. They will convert to class factor and then also perform or allow certain ordering of the levels - for example using <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">forcats::fct_relevel()</a></code> lets you manually specify the level order.
The function <code>as_factor()</code> simply converts the class without any further capabilities.</p>
<p>The <code>base R</code> function <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> converts a column to factor and allows you to manually specify the order of the levels, as a character vector to its <code>levels =</code> argument.</p>
<p>Below we use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code>fct_relevel()</code> to convert the column flipper_range from class character to class factor.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_range <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">flipper_range</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">flipper_range</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "large"  "medium" "small"</code></pre>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Correct the code in your script with this version</span>
<span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_range <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">flipper_range</span>, <span class="st">"small"</span>, <span class="st">"medium"</span>, <span class="st">"large"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now when we call a plot, we can see that the x axis categories match the intrinsic order we have specified with our factor levels.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_range</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-data-wrangling-part-2_files/figure-html/unnamed-chunk-43-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="finished-1" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Finished<a class="anchor" aria-label="anchor" href="#finished-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Make sure you have <strong>saved your script 💾</strong> and given it the filename "01_import_penguins_data.R" in the <a href="#activity-1-organising-our-workspace">"scripts" folder</a>.</p></li>
<li><p>Make sure your workspace is set <strong>not</strong> to save objects from the environment <a href="r-basics.html#global-options"><em>between</em> sessions</a>.</p></li>
<li><p>Does your workspace look like the below?</p></li>
</ul>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-44"></span>
<img src="images/project_penguin.png" alt="My neat project layout" width="100%"><p class="caption">
Figure 5.1: My neat project layout
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-45"></span>
<img src="images/r_script.png" alt="My scripts and file subdirectory" width="100%"><p class="caption">
Figure 5.2: My scripts and file subdirectory
</p>
</div>
</div>
<div id="activity-test-yourself" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Activity: Test yourself<a class="anchor" aria-label="anchor" href="#activity-test-yourself"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Question 1.</strong> In order to subset a data by <strong>rows</strong> I should use the function <select class="webex-select"><option value="blank"></option>
<option value="">select()</option>
<option value="answer">filter()</option>
<option value="">group_by()</option></select></p>
<p><strong>Question 2.</strong> In order to subset a data by <strong>columns</strong> I should use the function <select class="webex-select"><option value="blank"></option>
<option value="answer">select()</option>
<option value="">filter()</option>
<option value="">group_by()</option></select></p>
<p><strong>Question 3.</strong> In order to make a new column I should use the function <select class="webex-select"><option value="blank"></option>
<option value="">group_by()</option>
<option value="">select()</option>
<option value="answer">mutate()</option>
<option value="">arrange()</option></select></p>
<p><strong>Question 4.</strong> Which operator should I use to send the output from line of code into the next line? <input class="webex-solveme nospaces" size="3" data-answer='["%&gt;%"]'></p>
<p><strong>Question 5.</strong> What will be the outcome of the following line of code?</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span></code></pre></div>
<p><select class="webex-select"><option value="blank"></option>
<option value="">The penguins dataframe object is reduced to include only Adelie penguins from now on</option>
<option value="answer">A new filtered dataframe of only Adelie penguins will be printed into the console</option></select></p>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>Unless the output of a series of functions is "assigned" to an object using <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> it will not be saved, the results will be immediately printed. This code would have to be modified to the below in order to create a new filtered object <code>penguins_filtered</code></p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_filtered</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span></code></pre></div>
</div>
<p><br></p>
<p><strong>Question 5.</strong> What is the main point of a data "pipe"?</p>
<p><select class="webex-select"><option value="blank"></option>
<option value="">The code runs faster</option>
<option value="answer">The code is easier to read</option></select></p>
<p><strong>Question 6.</strong> The naming convention outputted by the function `janitor::clean_names() is
<select class="webex-select"><option value="blank"></option>
<option value="answer">snake_case</option>
<option value="">camelCase</option>
<option value="">SCREAMING_SNAKE_CASE</option>
<option value="">kebab-case</option></select></p>
<p><strong>Question 7.</strong> Which package provides useful functions for manipulating character strings?</p>
<p><select class="webex-select"><option value="blank"></option>
<option value="answer">stringr</option>
<option value="">ggplot2</option>
<option value="">lubridate</option>
<option value="">forcats</option></select></p>
<p><strong>Question 8.</strong> Which package provides useful functions for manipulating dates?</p>
<p><select class="webex-select"><option value="blank"></option>
<option value="">stringr</option>
<option value="">ggplot2</option>
<option value="answer">lubridate</option>
<option value="">forcats</option></select></p>
<p><strong>Question 9.</strong> If we do not specify a character variable as a factor, then ordering will default to what?</p>
<p><select class="webex-select"><option value="blank"></option>
<option value="">numerical</option>
<option value="answer">alphabetical</option>
<option value="">order in the dataframe</option></select></p>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="data-wrangling-part-one.html"><span class="header-section-number">4</span> Data wrangling part one</a></div>
<div class="next"><a href="data-visualisation-with-ggplot2.html"><span class="header-section-number">6</span> Data visualisation with ggplot2</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-wrangling-part-two"><span class="header-section-number">5</span> Data wrangling part two</a></li>
<li>
<a class="nav-link" href="#load-your-workspace-1"><span class="header-section-number">5.1</span> Load your workspace</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#checklist-1"><span class="header-section-number">5.1.1</span> Checklist</a></li></ul>
</li>
<li>
<a class="nav-link" href="#more-summary-tools"><span class="header-section-number">5.2</span> More summary tools</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-summarise"><span class="header-section-number">5.2.1</span> Using summarise()</a></li>
<li><a class="nav-link" href="#summarize-across-columns"><span class="header-section-number">5.2.2</span> Summarize across columns</a></li>
<li><a class="nav-link" href="#group_by-revisited"><span class="header-section-number">5.2.3</span> group_by revisited</a></li>
<li><a class="nav-link" href="#more-than-one-grouping-variable"><span class="header-section-number">5.2.4</span> More than one grouping variable</a></li>
<li><a class="nav-link" href="#using-group_by-with-mutate"><span class="header-section-number">5.2.5</span> using group_by with mutate</a></li>
<li><a class="nav-link" href="#remove-group_by"><span class="header-section-number">5.2.6</span> remove group_by</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#working-with-character-strings"><span class="header-section-number">5.3</span> Working with character strings</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#more-stringr"><span class="header-section-number">5.3.1</span> More stringr</a></li>
<li><a class="nav-link" href="#separate"><span class="header-section-number">5.3.2</span> separate</a></li>
</ul>
</li>
<li><a class="nav-link" href="#changing-data-formats"><span class="header-section-number">5.4</span> Changing data formats</a></li>
<li>
<a class="nav-link" href="#working-with-dates"><span class="header-section-number">5.5</span> Working with dates</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#calculations-with-dates"><span class="header-section-number">5.5.1</span> Calculations with dates</a></li></ul>
</li>
<li><a class="nav-link" href="#factors"><span class="header-section-number">5.6</span> Factors</a></li>
<li><a class="nav-link" href="#finished-1"><span class="header-section-number">5.7</span> Finished</a></li>
<li><a class="nav-link" href="#activity-test-yourself"><span class="header-section-number">5.8</span> Activity: Test yourself</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/UEABIO/data-sci-v1/blob/main/book/05-data-wrangling-part-2.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/UEABIO/data-sci-v1/edit/main/book/05-data-wrangling-part-2.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>5023Y</strong>: Data Science for Biologists" was written by Philip T. Leftwich. It was last built on 2022-10-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
