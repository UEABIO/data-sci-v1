<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Data insights part two | 5023Y</title>
<meta name="author" content="Philip T. Leftwich">
<meta name="description" content="In the previous chapter we looked at individual variables, and understanding the different types of data. We made numeric and graphical summaries of the distributions of features within each...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 11 Data insights part two | 5023Y">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ueabio.github.io/data-sci/data-insights-part-two.html">
<meta property="og:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<meta property="og:description" content="In the previous chapter we looked at individual variables, and understanding the different types of data. We made numeric and graphical summaries of the distributions of features within each...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Data insights part two | 5023Y">
<meta name="twitter:description" content="In the previous chapter we looked at individual variables, and understanding the different types of data. We made numeric and graphical summaries of the distributions of features within each...">
<meta name="twitter:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/font-awesome-5.13.0/js/script.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script language="javascript"> 
        function toggle(id) {
            var ele = document.getElementById("toggleText" + id);
            var text = document.getElementById("displayText" + id);
            var buttonText = text.innerHTML.replace("Show ", "");
            buttonText = buttonText.replace("Hide ", "");
            if(ele.style.display == "block") {
                ele.style.display = "none";
                text.innerHTML = "Show " + buttonText;
            } else {
                ele.style.display = "block";
                text.innerHTML = "Hide " + buttonText;
            }
        } 
    </script><script language="javascript">
        function openCode(evt, codeName, id) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent" + id);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks" + id);
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(codeName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script><script language="javascript">
        function hide(id){
            document.getElementById(id).style.display = "none";
        }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Data Science for Biologists">5023Y</a>:
        <small class="text-muted">Data Science for Biologists</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Get Started in R</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics</a></li>
<li class="book-part">Exploring Data</li>
<li><a class="" href="loading-data.html"><span class="header-section-number">3</span> Loading data</a></li>
<li><a class="" href="data-wrangling-part-one.html"><span class="header-section-number">4</span> Data wrangling part one</a></li>
<li><a class="" href="data-wrangling-part-two.html"><span class="header-section-number">5</span> Data wrangling part two</a></li>
<li><a class="" href="data-visualisation-with-ggplot2.html"><span class="header-section-number">6</span> Data visualisation with ggplot2</a></li>
<li class="book-part">Literate Programming and Reproducibility</li>
<li><a class="" href="markdown.html"><span class="header-section-number">7</span> Markdown</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Github</a></li>
<li class="book-part">R Programming</li>
<li><a class="" href="functions-1.html"><span class="header-section-number">9</span> Functions</a></li>
<li class="book-part">Advanced Data Insights</li>
<li><a class="" href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></li>
<li><a class="active" href="data-insights-part-two.html"><span class="header-section-number">11</span> Data insights part two</a></li>
<li class="book-part">Statistics</li>
<li><a class="" href="introduction-to-statistics.html"><span class="header-section-number">12</span> Introduction to statistics</a></li>
<li><a class="" href="introduction-to-linear-models.html"><span class="header-section-number">13</span> Introduction to Linear Models</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">14</span> Testing</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">15</span> Regression</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">16</span> ANOVA</a></li>
<li><a class="" href="multivariate-linear-models.html"><span class="header-section-number">17</span> Multivariate linear models</a></li>
<li><a class="" href="complex-models.html"><span class="header-section-number">18</span> Complex models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">19</span> Generalized Linear Models</a></li>
<li class="book-part">Advanced topics</li>
<li><a class="" href="mixed-models.html"><span class="header-section-number">20</span> Mixed models</a></li>
<li><a class="" href="generalised-additive-models.html"><span class="header-section-number">21</span> Generalised Additive Models</a></li>
<li><a class="" href="survival-models.html"><span class="header-section-number">22</span> Survival models</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">23</span> Unsupervised Machine Learning</a></li>
<li><a class="" href="power-analysis.html"><span class="header-section-number">24</span> Power analysis</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">25</span> Iteration</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="updating-r-rstudio-and-packages.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="exporting-files-from-the-server.html"><span class="header-section-number">C</span> Exporting files from the server</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">D</span> Symbols</a></li>
<li><a class="" href="baser.html"><span class="header-section-number">E</span> Base R vs. Tidyverse</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/UEABIO/data-sci-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-insights-part-two" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Data insights part two<a class="anchor" aria-label="anchor" href="#data-insights-part-two"><i class="fas fa-link"></i></a>
</h1>
<p>In the previous chapter we looked at individual variables, and understanding the different types of data. We made numeric and graphical summaries of the distributions of features within each variable. This week we will continue to work in the same space, and extend our understanding to include relationships between variables.</p>
<p>Understanding the relationship between two or more variables is often the basis of most of our scientific questions. These might include comparing variables of the same type (numeric against numeric) or different types (numeric against categorical). In this chapter we will see how we can use descriptive statistics and visuals to explore associations</p>
<div id="associations-between-numerical-variables" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Associations between numerical variables<a class="anchor" aria-label="anchor" href="#associations-between-numerical-variables"><i class="fas fa-link"></i></a>
</h2>
<div id="correlations" class="section level3" number="11.1.1">
<h3>
<span class="header-section-number">11.1.1</span> Correlations<a class="anchor" aria-label="anchor" href="#correlations"><i class="fas fa-link"></i></a>
</h3>
<p>A common measure of association between two numerical variables is the <strong>correlation coefficient</strong>. The correlation metric is a numerical measure of the <em>strength of an association</em></p>
<p>There are several measures of correlation including:</p>
<ul>
<li><p><strong>Pearson's correlation coefficient</strong> : good for describing linear associations</p></li>
<li><p><strong>Spearman's rank correlation coefficient</strong>: a rank ordered correlation - good for when the assumptions for Pearson's correlation is not met.</p></li>
</ul>
<p>Pearson's correlation coefficient <em>r</em> is designed to measure the strength of a linear (straight line) association. Pearson's takes a value between -1 and 1.</p>
<ul>
<li><p>A value of 0 means there is no linear association between the variables</p></li>
<li><p>A value of 1 means there is a perfect <em>positive</em> association between the variables</p></li>
<li><p>A value of -1 means there is a perfect <em>negative</em> association between the variables</p></li>
</ul>
<p>A <em>perfect</em> association is one where we can predict the value of one variable with complete accuracy, just by knowing the value of the other variable.</p>
<p>We can use the <code>cor</code> function in R to calculate Pearson's correlation coefficient.</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/rstatix/">rstatix</a></span><span class="op">)</span>

<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rpkgs.datanovia.com/rstatix/reference/cor_test.html">cor_test</a></span><span class="op">(</span><span class="va">culmen_length_mm</span>, <span class="va">culmen_depth_mm</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
var1
</th>
<th style="text-align:left;">
var2
</th>
<th style="text-align:right;">
cor
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
culmen_length_mm
</td>
<td style="text-align:left;">
culmen_depth_mm
</td>
<td style="text-align:right;">
-0.24
</td>
<td style="text-align:right;">
-4.459093
</td>
<td style="text-align:right;">
1.12e-05
</td>
<td style="text-align:right;">
-0.3328072
</td>
<td style="text-align:right;">
-0.1323004
</td>
<td style="text-align:left;">
Pearson
</td>
</tr></tbody>
</table></div>
</div>
<p>This tells us two features of the association. It's <em>sign</em> and <em>magnitude</em>. The coefficient is negative, so as bill length increases, bill depth decreases. The value -0.22 indicates that only about 22% of the variation in bill length can be explained by changes in bill depth (and <em>vice-versa</em>), suggesting that the variables are not closely related.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-37"></span>
<img src="images/correlation_examples.png" alt="Different relationships between two numeric variables. Each number represents the Pearson's correlation coefficient of each association" width="80%"><p class="caption">
Figure 1.4: Different relationships between two numeric variables. Each number represents the Pearson's correlation coefficient of each association
</p>
</div>
<ul>
<li><p>Because Pearson's coefficient is designed to summarise the strength of a linear relationship, this can be misleading if the relationship is <em>not linear</em> e.g. curved or humped. This is why it's always a good idea to plot the relationship <em>first</em> (see above).</p></li>
<li><p>Even when the relationship is linear, it doesn't tell us anything about the steepness of the association (see above). It <em>only</em> tells us how often a change in one variable can predict the change in the other <em>not</em> the value of that change.</p></li>
</ul>
<p>This can be difficult to understand at first, so carefully consider the figure above.</p>
<ul>
<li><p>The first row above shows differing levels of the strength of association. If we drew a perfect straight line between two variables, how closely do the data points fit around this line.</p></li>
<li><p>The second row shows a series of <em>perfect</em> linear relationships. We can accurately predict the value of one variable just by knowing the value of the other variable, but the steepness of the relationship in each example is very different. This is <strong>important</strong> because it means a perfect association can still have a small effect.</p></li>
<li><p>The third row shows a series of associations where there is <em>clearly</em> a relationship between the two variables, but it is also not linear so would be inappropriate for a Pearson's correlation.</p></li>
</ul>
</div>
<div id="non-linear-correlations" class="section level3" number="11.1.2">
<h3>
<span class="header-section-number">11.1.2</span> Non-linear correlations<a class="anchor" aria-label="anchor" href="#non-linear-correlations"><i class="fas fa-link"></i></a>
</h3>
<p>So what should we do if the relationship between our variables is non-linear? Instead of using Pearson's correlation coefficient we can calculate something called a <strong>rank correlation</strong>.</p>
<p>Instead of working with the raw values of our two variables we can use rank ordering instead. The idea is pretty simple if we start with the lowest vaule in a variable and order it as '1', then assign labels '2', '3' etc. as we ascend in rank order. We can see a way that this could be applied manually with the function <code>dense_rank</code> from dplyr below:</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">culmen_length_mm</span>, 
                    <span class="va">culmen_depth_mm</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank_length<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">dense_rank</a></span><span class="op">(</span><span class="op">(</span><span class="va">culmen_length_mm</span><span class="op">)</span><span class="op">)</span>, 
         rank_depth<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">dense_rank</a></span><span class="op">(</span><span class="op">(</span><span class="va">culmen_depth_mm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
culmen_length_mm
</th>
<th style="text-align:right;">
culmen_depth_mm
</th>
<th style="text-align:right;">
rank_length
</th>
<th style="text-align:right;">
rank_depth
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
39.1
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
57
</td>
</tr>
<tr>
<td style="text-align:right;">
39.5
</td>
<td style="text-align:right;">
17.4
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
44
</td>
</tr>
<tr>
<td style="text-align:right;">
40.3
</td>
<td style="text-align:right;">
18.0
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
36.7
</td>
<td style="text-align:right;">
19.3
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
63
</td>
</tr>
<tr>
<td style="text-align:right;">
39.3
</td>
<td style="text-align:right;">
20.6
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
75
</td>
</tr>
<tr>
<td style="text-align:right;">
38.9
</td>
<td style="text-align:right;">
17.8
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
48
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Measures of rank correlation then are just a comparison of the rank orders between two variables, with a value between -1 and 1 just like Pearsons's. We already know from our Pearson's correlation coefficient, that we expect this relationship to be negative. So it should come as no surprise that the highest rank order values for bill_length_mm appear to be associated with lower rank order values for bill_depth_mm.</p>
<p>To calculate Spearman's <span class="math inline">\(\rho\)</span> 'rho' is pretty easy, you can use the cor functions again, but this time specify a hidden argument to <code>method="spearman"</code>.</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rpkgs.datanovia.com/rstatix/reference/cor_test.html">cor_test</a></span><span class="op">(</span><span class="va">culmen_length_mm</span>, <span class="va">culmen_depth_mm</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
var1
</th>
<th style="text-align:left;">
var2
</th>
<th style="text-align:right;">
cor
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
culmen_length_mm
</td>
<td style="text-align:left;">
culmen_depth_mm
</td>
<td style="text-align:right;">
-0.22
</td>
<td style="text-align:right;">
8145268
</td>
<td style="text-align:right;">
3.51e-05
</td>
<td style="text-align:left;">
Spearman
</td>
</tr></tbody>
</table></div>
</div>
<p>What we can see in this example is that Pearson's <em>r</em> and Spearman's <span class="math inline">\(\rho\)</span> are basically identical.</p>
</div>
<div id="graphical-summaries-between-numeric-variables" class="section level3" number="11.1.3">
<h3>
<span class="header-section-number">11.1.3</span> Graphical summaries between numeric variables<a class="anchor" aria-label="anchor" href="#graphical-summaries-between-numeric-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Correlation coefficients are a quick and simple way to attach a metric to the level of association between two variables. They are limited however in that a single number can never capture the every aspect of their relationship. This is why we visualise our data.</p>
<p>We have already covered scatter plots and <code><a href="https://ggplot2.tidyverse.org/reference/ggplot2-package.html">ggplot2()</a></code> extensively in previous chapters, so here we will just cover some of the different ways in which you could present the nature of a relationship</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">length_depth_scatterplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">culmen_length_mm</span>, 
                     y<span class="op">=</span> <span class="va">culmen_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">length_depth_scatterplot</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-40"></span>
<img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-40-1.png" alt="A scatter plot of bill depth against bill length in mm" width="100%"><p class="caption">
Figure 11.1: A scatter plot of bill depth against bill length in mm
</p>
</div>
<blockquote>
<p>**Note - Remember there are a number of different options available when constructing a plot including changing alpha to produce transparency if plots are lying on top of each other, colours (and shapes) to separate subgroups and ways to present third numerical variables such as setting aes(size=body_mass_g).</p>
</blockquote>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co"># package calls should be placed at the TOP of your script</span>

<span class="va">bill_depth_marginal</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">culmen_depth_mm</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"darkgrey"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># this graph needs to be rotated</span>

<span class="va">bill_length_marginal</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">culmen_length_mm</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"darkgrey"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">layout</span> <span class="op">&lt;-</span> <span class="st">"
AA#
BBC
BBC"</span>
<span class="co"># layout is easiest to organise using a text distribution, where ABC equal the three plots in order, and the grid is how much space they take up. We could easily make the main plot bigger and marginals smaller with</span>

<span class="co"># layout &lt;- "</span>
<span class="co"># AAA#</span>
<span class="co"># BBBC</span>
<span class="co"># BBBC"</span>
<span class="co"># BBBC</span>

<span class="va">bill_length_marginal</span><span class="op">+</span><span class="va">length_depth_scatterplot</span><span class="op">+</span><span class="va">bill_depth_marginal</span><span class="op">+</span> <span class="co"># order of plots is important</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">layout</span><span class="op">)</span> <span class="co"># uses the layout argument defined above to arrange the size and position of plots</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-41"></span>
<img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-41-1.png" alt="Using patchwork we can easily arrange extra plots to fit as marginals - these could be boxplots, histograms or density plots" width="100%"><p class="caption">
Figure 11.2: Using patchwork we can easily arrange extra plots to fit as marginals - these could be boxplots, histograms or density plots
</p>
</div>
<p>These efforts allow us to capture details about the spread and distribution of both variables <strong>and</strong> how they relate to each other. This figure provides us with insights into</p>
<ul>
<li><p>The central tendency of each variable</p></li>
<li><p>The spread of data in each variable</p></li>
<li><p>The correlation between the two variables</p></li>
</ul>
</div>
</div>
<div id="associations-between-categorical-variables" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Associations between categorical variables<a class="anchor" aria-label="anchor" href="#associations-between-categorical-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Exploring associations between different categorical variables is not quite as simple as the previous numeric-numeric examples. Generally speaking we are interested in whether different combinations of categories are uniformally distributed or show evidence of clustering leading to <em>over- or under-represented</em> combinations.
The simplest way to investigate this is to use <code>group_by</code> and <code>summarise</code> as we have used previously.</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_species_summary</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">island</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
            n_distinct<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">individual_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># needed to remove group calculations</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>freq<span class="op">=</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co"># then calculates percentage of each group across WHOLE dataset</span>

<span class="va">island_species_summary</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
island
</th>
<th style="text-align:left;">
species
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
n_distinct
</th>
<th style="text-align:right;">
freq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Biscoe
</td>
<td style="text-align:left;">
Adelie
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
0.1279070
</td>
</tr>
<tr>
<td style="text-align:left;">
Biscoe
</td>
<td style="text-align:left;">
Gentoo
</td>
<td style="text-align:right;">
124
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
0.3604651
</td>
</tr>
<tr>
<td style="text-align:left;">
Dream
</td>
<td style="text-align:left;">
Adelie
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
0.1627907
</td>
</tr>
<tr>
<td style="text-align:left;">
Dream
</td>
<td style="text-align:left;">
Chinstrap
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
0.1976744
</td>
</tr>
<tr>
<td style="text-align:left;">
Torgersen
</td>
<td style="text-align:left;">
Adelie
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
0.1511628
</td>
</tr>
</tbody>
</table></div>
</div>
<blockquote>
<p>**Note - remember that group_by() applies functions which comes after it in a group-specific pattern.</p>
</blockquote>
<p>What does the above tell us, that 168 observations were made on the Island of Biscoe, with three times as many Gentoo penguin observations made as Adelie penguins (remeber this is observations made, not individual penguins). When we account for penguin ID we see there are around twice as many Gentoo penguins recorded. We can see there are no Chinstrap penguins recorded on Biscoe. Conversely we can see that Gentoo penguins are <strong>only</strong> observed on Biscoe.
The island of Dream has two populations of Adelie and Chinstrap penguins of roughly equal size, while the island of Torgensen appears to have a population comprised only of Adelie penguins.</p>
<p>We could also use a bar chart in ggplot to represent this count data.</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span><span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">island</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-43-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>This is fine, but it looks a bit odd, because the bars expand to fill the available space on the category axis. Luckily there is an advanced version of the postion_dodge argument.</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span><span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">island</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge2</a></span><span class="op">(</span>preserve<span class="op">=</span><span class="st">"single"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="co">#keeps bars to appropriate widths</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-44-1.png" width="100%" style="display: block; margin: auto;">
&gt; **Note the default for bar charts would have been a stacked option, but we have already seen how that can produce graphs that are difficult to read.</div>
<p>An alternative approach would be to look at the 'relative proportions' of each population in our overall dataset. Using the same methods as we used previously when looking at single variables. Let's add in a few aesthetic tweaks to improve the look.</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">island</span>, fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge2</a></span><span class="op">(</span>preserve<span class="op">=</span><span class="st">"single"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="co">#keeps bars to appropriate widths</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Island"</span>,
       y <span class="op">=</span> <span class="st">"Number of observations"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">island_species_summary</span>, <span class="co"># use the data from the summarise object</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">island</span>,
                y<span class="op">=</span> <span class="va">n</span><span class="op">+</span><span class="fl">10</span>, <span class="co"># offset text to be slightly to the right of bar</span>
                group<span class="op">=</span><span class="va">species</span>, <span class="co"># need species group to separate text</span>
                label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span> <span class="co"># automatically add %</span>
                <span class="op">)</span>,
            position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge2</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># set width of dodge</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cyan"</span>,
                            <span class="st">"darkorange"</span>,
                            <span class="st">"purple"</span>
                            <span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="co"># put legend at the bottom of the graph</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-45"></span>
<img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-45-1.png" alt="A dodged barplot showing the numbers and relative proportions of data observations recorded by penguin species and location" width="100%"><p class="caption">
Figure 5.2: A dodged barplot showing the numbers and relative proportions of data observations recorded by penguin species and location
</p>
</div>
</div>
<div id="associations-between-categorical-numerical-variables" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Associations between Categorical-numerical variables<a class="anchor" aria-label="anchor" href="#associations-between-categorical-numerical-variables"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">species</span>,
             y<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Body mass (g)"</span>,
         x<span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-46-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span>,
             fill<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span>,
         bins<span class="op">=</span><span class="fl">30</span>,
         position<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">species</span>,
             ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-47-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="complexity" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Complexity<a class="anchor" aria-label="anchor" href="#complexity"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/complexity.png" title="Variables such as species or sex may directly or indirectly affect the relationship between body mass and beak length" alt="Variables such as species or sex may directly or indirectly affect the relationship between body mass and beak length" width="80%" style="display: block; margin: auto;"></div>
<p>It is reasonable to think that perhaps either species or sex might affect the morphology of beaks directly - or that these might affect body mass (so that if there is a direct relationship between mass and beak length, there will also be an indirect relationship with sex or species).</p>
<p>Failure to account for complex interactions can lead to misleading insights about your data.</p>
<div id="simpsons-paradox" class="section level3" number="11.4.1">
<h3>
<span class="header-section-number">11.4.1</span> Simpson's Paradox<a class="anchor" aria-label="anchor" href="#simpsons-paradox"><i class="fas fa-link"></i></a>
</h3>
<p>Remember when we first correlated bill length and bill depth against each other we found an overall negative correlation of -0.22. However, this is because of a confounding variable we had not accounted for - species.</p>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-49-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>This is another example of why carefully studying your data - and carefully considering those variables which are likely to affect each other are studied or controlled for. It is an entirely reasonable hypothesis that different penguin species might have different bill shapes that might make an overall trend misleading. We can easily check the effect of a categoricial variable on our two numeric variables by assigning the aesthetic colour.</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cyan"</span>,
             <span class="st">"darkorange"</span>,
             <span class="st">"purple"</span><span class="op">)</span>

<span class="va">length_depth_scatterplot_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">culmen_length_mm</span>, 
                     y<span class="op">=</span> <span class="va">culmen_depth_mm</span>,
                     colour<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>,
              se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">colours</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Bill length (mm)"</span>,
         y<span class="op">=</span><span class="st">"Bill depth (mm)"</span><span class="op">)</span>

<span class="va">length_depth_scatterplot</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-50-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bill_depth_marginal_2</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">culmen_depth_mm</span>,
                   fill<span class="op">=</span><span class="va">species</span><span class="op">)</span>,
               alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">colours</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># this graph needs to be rotated</span>

<span class="va">bill_length_marginal_2</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">culmen_length_mm</span>,
                   fill<span class="op">=</span><span class="va">species</span><span class="op">)</span>,
               alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">colours</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>

<span class="va">layout2</span> <span class="op">&lt;-</span> <span class="st">"
AAA#
BBBC
BBBC
BBBC"</span>

<span class="va">bill_length_marginal_2</span><span class="op">+</span><span class="va">length_depth_scatterplot_2</span><span class="op">+</span><span class="va">bill_depth_marginal_2</span><span class="op">+</span> <span class="co"># order of plots is important</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">layout2</span><span class="op">)</span> <span class="co"># uses the layout argument defined above to arrange the size and position of plots</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-50-2.png" width="100%" style="display: block; margin: auto;"></div>
<p>We now clearly see a striking reversal of our previous trend, that in fact <em>within</em> each species of penguin there is an overall positive association between bill length and depth.</p>
<p>This should prompt us to re-evaluate our correlation metrics:</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rpkgs.datanovia.com/rstatix/reference/cor_test.html">cor_test</a></span><span class="op">(</span><span class="va">culmen_length_mm</span>, <span class="va">culmen_depth_mm</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
var1
</th>
<th style="text-align:left;">
var2
</th>
<th style="text-align:right;">
cor
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Adelie
</td>
<td style="text-align:left;">
culmen_length_mm
</td>
<td style="text-align:left;">
culmen_depth_mm
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
5.193285
</td>
<td style="text-align:right;">
7e-07
</td>
<td style="text-align:right;">
0.2472226
</td>
<td style="text-align:right;">
0.5187796
</td>
<td style="text-align:left;">
Pearson
</td>
</tr>
<tr>
<td style="text-align:left;">
Chinstrap
</td>
<td style="text-align:left;">
culmen_length_mm
</td>
<td style="text-align:left;">
culmen_depth_mm
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
7.014647
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.4917326
</td>
<td style="text-align:right;">
0.7717134
</td>
<td style="text-align:left;">
Pearson
</td>
</tr>
<tr>
<td style="text-align:left;">
Gentoo
</td>
<td style="text-align:left;">
culmen_length_mm
</td>
<td style="text-align:left;">
culmen_depth_mm
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
9.244703
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.5262952
</td>
<td style="text-align:right;">
0.7365271
</td>
<td style="text-align:left;">
Pearson
</td>
</tr>
</tbody>
</table></div>
</div>
<p>We now see that the correlation values for all three species is &gt;0.22 - indicating these associations are much closer than previously estimated.</p>
</div>
<div id="three-or-more-variables" class="section level3" number="11.4.2">
<h3>
<span class="header-section-number">11.4.2</span> Three or more variables<a class="anchor" aria-label="anchor" href="#three-or-more-variables"><i class="fas fa-link"></i></a>
</h3>
<p>In the above example therefore, we saw the importance of exploring relationships among more than two variables at once. Broadly speaking there are two ways top do this</p>
<ol style="list-style-type: decimal">
<li>Layer an extra aesthetic mapping onto ggplot - such as size, colour, or shape</li>
</ol>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">culmen_length_mm</span>, 
                     y<span class="op">=</span> <span class="va">culmen_depth_mm</span>,
                     colour<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># colour aesthetic set to sex</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,
              method<span class="op">=</span><span class="st">"lm"</span>,
              se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1B9E77"</span>, <span class="st">"#D95F02"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># pick two colour scheme</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Bill length (mm)"</span>,
         y<span class="op">=</span><span class="st">"Bill depth (mm)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-52-1.png" width="100%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li>Use facets to construct multipanel plots according to the values of a categorical variable</li>
</ol>
<p>If we want we can also adopt both of these approaches at the same time:</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">culmen_length_mm</span>, 
                     y<span class="op">=</span> <span class="va">culmen_depth_mm</span>,
                     colour<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># colour aesthetic set to sex</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>,
              se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1B9E77"</span>, <span class="st">"#D95F02"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># pick two colour scheme</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Bill length (mm)"</span>,
         y<span class="op">=</span><span class="st">"Bill depth (mm)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">species</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># specify plots are stacked split by species</span></code></pre></div>
<div class="inline-figure"><img src="10-Data-insights-part-1_files/figure-html/unnamed-chunk-53-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Here we can see that the trends are the same across the different penguin sexes. Although by comparing the slopes of the lines, lengths of the lines and amounts of overlap we can make insights into how "sexually dimorphic" these different species are e.g. in terms of beak morphology do some species show greater differences between males and females than others?</p>
</div>
</div>
<div id="summing-up" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Summing up<a class="anchor" aria-label="anchor" href="#summing-up"><i class="fas fa-link"></i></a>
</h2>
<p>This is our last data handling workshop. We have built up towards being able to discover and examine relationships and differences among variables in our data. You now have the skills to handle many different types of data, tidy it, and produce visuals to generate insight and communicate this to others.</p>
<p>A note of caution is required - it is very easy to spot and identify patterns.</p>
<p>When you do spot a trend, difference or relationship, it is important to recognise that you may not have enough evidence to assign a reason behind this observation. As scientists it is important to develope hypotheses based on knowledge and understanding, this can help (sometimes) with avoiding spurious associations.</p>
<p>Sometimes we may see a pattern in our data, but it has likely occurred due to random chance, rather than as a result of an underlying process. This is where formal statistical analysis, to quantitatively assess the evidence, assess probability and study effect sizes can be incredibly powerful. We will delve into these exciting topics next term.</p>
<p>That's it! Thank you for taking the time to get this far. Be kind to yourself if you found it difficult. You have done incredibly well.</p>
<p>Have some praise!!!!</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">praise</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/praise/man/praise.html">praise</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "You are wonderful!"</code></pre>
<pre><code>[1] "You are spectaculaR!"</code></pre>

</div>
</div>



<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></div>
<div class="next"><a href="introduction-to-statistics.html"><span class="header-section-number">12</span> Introduction to statistics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-insights-part-two"><span class="header-section-number">11</span> Data insights part two</a></li>
<li>
<a class="nav-link" href="#associations-between-numerical-variables"><span class="header-section-number">11.1</span> Associations between numerical variables</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#correlations"><span class="header-section-number">11.1.1</span> Correlations</a></li>
<li><a class="nav-link" href="#non-linear-correlations"><span class="header-section-number">11.1.2</span> Non-linear correlations</a></li>
<li><a class="nav-link" href="#graphical-summaries-between-numeric-variables"><span class="header-section-number">11.1.3</span> Graphical summaries between numeric variables</a></li>
</ul>
</li>
<li><a class="nav-link" href="#associations-between-categorical-variables"><span class="header-section-number">11.2</span> Associations between categorical variables</a></li>
<li><a class="nav-link" href="#associations-between-categorical-numerical-variables"><span class="header-section-number">11.3</span> Associations between Categorical-numerical variables</a></li>
<li>
<a class="nav-link" href="#complexity"><span class="header-section-number">11.4</span> Complexity</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simpsons-paradox"><span class="header-section-number">11.4.1</span> Simpson's Paradox</a></li>
<li><a class="nav-link" href="#three-or-more-variables"><span class="header-section-number">11.4.2</span> Three or more variables</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summing-up"><span class="header-section-number">11.5</span> Summing up</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/UEABIO/data-sci-v1/blob/main/book/10-Data-insights-part-1.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/UEABIO/data-sci-v1/edit/main/book/10-Data-insights-part-1.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>5023Y</strong>: Data Science for Biologists" was written by Philip T. Leftwich. It was last built on 2022-11-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
