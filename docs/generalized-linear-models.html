<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 19 Generalized Linear Models | 5023Y</title>
<meta name="author" content="Philip T. Leftwich">
<meta name="description" content="19.1 Motivation In the previous workshop we have seen that linear models are a powerful modelling tool. However, we have to satisfy the following assumptions: A linear relationship between...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 19 Generalized Linear Models | 5023Y">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ueabio.github.io/data-sci/generalized-linear-models.html">
<meta property="og:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<meta property="og:description" content="19.1 Motivation In the previous workshop we have seen that linear models are a powerful modelling tool. However, we have to satisfy the following assumptions: A linear relationship between...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 19 Generalized Linear Models | 5023Y">
<meta name="twitter:description" content="19.1 Motivation In the previous workshop we have seen that linear models are a powerful modelling tool. However, we have to satisfy the following assumptions: A linear relationship between...">
<meta name="twitter:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/font-awesome-5.13.0/js/script.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script language="javascript"> 
        function toggle(id) {
            var ele = document.getElementById("toggleText" + id);
            var text = document.getElementById("displayText" + id);
            var buttonText = text.innerHTML.replace("Show ", "");
            buttonText = buttonText.replace("Hide ", "");
            if(ele.style.display == "block") {
                ele.style.display = "none";
                text.innerHTML = "Show " + buttonText;
            } else {
                ele.style.display = "block";
                text.innerHTML = "Hide " + buttonText;
            }
        } 
    </script><script language="javascript">
        function openCode(evt, codeName, id) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent" + id);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks" + id);
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(codeName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script><script language="javascript">
        function hide(id){
            document.getElementById(id).style.display = "none";
        }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Data Science for Biologists">5023Y</a>:
        <small class="text-muted">Data Science for Biologists</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li class="book-part">Get Started in R</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics</a></li>
<li class="book-part">Exploring Data</li>
<li><a class="" href="loading-data.html"><span class="header-section-number">3</span> Loading data</a></li>
<li><a class="" href="data-wrangling-part-one.html"><span class="header-section-number">4</span> Data wrangling part one</a></li>
<li><a class="" href="data-wrangling-part-two.html"><span class="header-section-number">5</span> Data wrangling part two</a></li>
<li><a class="" href="data-visualisation-with-ggplot2.html"><span class="header-section-number">6</span> Data visualisation with ggplot2</a></li>
<li class="book-part">Literate Programming and Reproducibility</li>
<li><a class="" href="markdown.html"><span class="header-section-number">7</span> Markdown</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Github</a></li>
<li class="book-part">R Programming</li>
<li><a class="" href="functions-1.html"><span class="header-section-number">9</span> Functions</a></li>
<li class="book-part">Advanced Data Insights</li>
<li><a class="" href="data-insights-part-one.html"><span class="header-section-number">10</span> Data Insights part one</a></li>
<li><a class="" href="data-insights-part-two.html"><span class="header-section-number">11</span> Data insights part two</a></li>
<li class="book-part">Statistics</li>
<li><a class="" href="introduction-to-statistics.html"><span class="header-section-number">12</span> Introduction to statistics</a></li>
<li><a class="" href="introduction-to-linear-models.html"><span class="header-section-number">13</span> Introduction to Linear Models</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">14</span> Testing</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">15</span> Regression</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">16</span> ANOVA</a></li>
<li><a class="" href="multivariate-linear-models.html"><span class="header-section-number">17</span> Multivariate linear models</a></li>
<li><a class="" href="complex-models.html"><span class="header-section-number">18</span> Complex models</a></li>
<li><a class="active" href="generalized-linear-models.html"><span class="header-section-number">19</span> Generalized Linear Models</a></li>
<li class="book-part">Advanced topics</li>
<li><a class="" href="mixed-models.html"><span class="header-section-number">20</span> Mixed models</a></li>
<li><a class="" href="generalised-additive-models.html"><span class="header-section-number">21</span> Generalised Additive Models</a></li>
<li><a class="" href="survival-models.html"><span class="header-section-number">22</span> Survival models</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">23</span> Unsupervised Machine Learning</a></li>
<li><a class="" href="power-analysis.html"><span class="header-section-number">24</span> Power analysis</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">25</span> Iteration</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="updating-r-rstudio-and-packages.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="exporting-files-from-the-server.html"><span class="header-section-number">C</span> Exporting files from the server</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">D</span> Symbols</a></li>
<li><a class="" href="baser.html"><span class="header-section-number">E</span> Base R vs. Tidyverse</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/UEABIO/data-sci-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="generalized-linear-models" class="section level1" number="19">
<h1>
<span class="header-section-number">19</span> Generalized Linear Models<a class="anchor" aria-label="anchor" href="#generalized-linear-models"><i class="fas fa-link"></i></a>
</h1>
<div id="motivation" class="section level2" number="19.1">
<h2>
<span class="header-section-number">19.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation"><i class="fas fa-link"></i></a>
</h2>
<p>In the previous workshop we have seen that linear models are a powerful modelling tool.
However, we have to satisfy the following assumptions:</p>
<ol style="list-style-type: decimal">
<li>A <strong>linear</strong> relationship between predictors and the mean response value.</li>
<li>Variances are equal across all predicted values of the response (<strong>homoscedatic</strong>)</li>
<li>Errors are <strong>normally</strong> distributed.</li>
<li>Samples collected at <strong>random</strong>.</li>
<li>No omitted variables of importance</li>
</ol>
<p>If assumptions 1-3 are violated we can often <em>transform</em> our response variable
to try and fix this (Box-Cox &amp; transformation).
However, in a lot of other cases this is either not possible (e.g binary output)
or we want to explicitly model the underlying distribution (e.g count data).
Instead, we can use <em>Generalized</em> Linear Models (GLMs) that let us change the <em>error structure</em> (assumption 3) to something other than a normal distribution.</p>
</div>
<div id="generalised-linear-models-glms" class="section level2" number="19.2">
<h2>
<span class="header-section-number">19.2</span> Generalised Linear Models (GLMs)<a class="anchor" aria-label="anchor" href="#generalised-linear-models-glms"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Generalised Linear Models</strong> (GLMs) have:</p>
<ol style="list-style-type: decimal">
<li><p>A linear predictor.</p></li>
<li><p>An <strong>error/variance structure</strong>.</p></li>
<li><p>A <strong>link function</strong> (like an 'internal' transformation).</p></li>
</ol>
<p>The first (1) should be familiar, its everything that comes after the <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> in a linear model formula. Or as an equation <span class="math inline">\(\beta_0 + \beta_1\)</span>. The second (2) should also be familiar, variance measures the error structure of the model <span class="math inline">\(\epsilon\)</span>. An ordinary least squares model uses the normal distribution, but <em>GLMs</em> are able to use a wider range of distributions including poisson, binomial and Gamma. The third component (3) is less familiar, the link function is the equivalent of a transformation in an ordinary least squares model. However, rather than transforming <em>the data</em>, we transform the predictions made by the linear predictors. Common link functions are log and square root.</p>
<div class="info">
<p>
<strong>Maximum Likelihood</strong> - Generalised Linear Models fit a regression line by finding the parameter values that best fit the model to the data. This is very similar to the way that ordinary least squares finds the line of best fit by reducing the sum of squared errors. In fact for data with normally distributed residuals, the particular form of maximum likelihood <strong>is</strong> least squares.
</p>
<p>
However the normal (gaussian) distribution will not be a good model for lots of other types of data, binary data, is a good example and one we will investigate in this workshop.
</p>
<p>
Maximum likelihood provides a more generalized approach to model fitting that includes, but is broader than, least squares.
</p>
<p>
An advantage of the least squares method we have been using is that we can generate precise equations for the fit of the line. In contrast the calculations for GLMs (which are beyond the scope of this course) are approximate, essentially multiple potential best fit lines are made and compared against each other.
</p>
<p>
You will see two main differences in a GLM output:
</p>
<p>
If the model is one where the mean and variance are calculated <em>separately</em> (e.g. for most normal distributions), uncertainty estimates use the <em>t</em> distribution; and when we compare complex to simplified models (using <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> or <code><a href="https://rdrr.io/r/stats/add1.html">drop1()</a></code>) we use the <em>F</em>-test.
</p>
<p>
However, when we provide distributions where the mean and variance are expected to change <em>together</em> (Poisson and Binomial), then we calculate uncertainty estimates using the <em>z</em> distribution, and compare models with the <em>chi-square</em> distribution.
</p>
</div>
<p>The simple linear regression model we have used so far is a special cases of a GLM:</p>
<pre><code><a href="https://rdrr.io/r/stats/lm.html">lm(height ~ weight)</a></code></pre>
<p>is equivalent to</p>
<pre><code><a href="https://rdrr.io/r/stats/glm.html">glm(height ~ weight, family=gaussian(link=identity))</a></code></pre>
<p>Compared to <a href="https://www.rdocumentation.org/packages/stats/versions/3.5.1/topics/lm"><code>lm()</code></a>, the <a href="https://www.rdocumentation.org/packages/stats/versions/3.5.1/topics/glm"><code>glm()</code></a> function takes an additional argument called <a href="https://www.rdocumentation.org/packages/stats/versions/3.5.1/topics/family"><code>family</code></a>, which
specifies the error structure <strong>and</strong> link function.</p>
<p>The default <strong>link function</strong> for the normal (Gaussian) distribution is the <strong>identity</strong>, <em>where no transformation is needed</em>i.e. for mean <span class="math inline">\(\mu\)</span> we have:</p>
<p><span class="math display">\[
\mu = \beta_0 + \beta_1 X
\]</span></p>
<p>Defaults are usually good choices (shown in bold below):</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Family</th>
<th align="center">Link</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>gaussian</code></td>
<td align="center"><strong><code>identity</code></strong></td>
</tr>
<tr class="even">
<td align="center"><code>binomial</code></td>
<td align="center">
<strong><code>logit</code></strong>, <code>probit</code> or <code>cloglog</code>
</td>
</tr>
<tr class="odd">
<td align="center"><code>poisson</code></td>
<td align="center">
<strong><code>log</code></strong>, <code>identity</code> or <code>sqrt</code>
</td>
</tr>
<tr class="even">
<td align="center"><code>Gamma</code></td>
<td align="center">
<strong><code>inverse</code></strong>, <code>identity</code> or <code>log</code>
</td>
</tr>
<tr class="odd">
<td align="center"><code>inverse.gaussian</code></td>
<td align="center"><strong><code>1/mu^2</code></strong></td>
</tr>
<tr class="even">
<td align="center"><code>quasibinomial</code></td>
<td align="center"><strong><code>logit</code></strong></td>
</tr>
<tr class="odd">
<td align="center"><code>quasipoisson</code></td>
<td align="center"><strong><code>log</code></strong></td>
</tr>
</tbody>
</table></div>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Using the fruitfly data introduced last week fit a linear model with lifespan as a response variable and sleep, type and thorax as explanatory variables. Compare this to a glm fitted with a gaussian error distribution and identity link for the mean
</div>
</div>
<button id="displayTextunnamed-chunk-6" onclick="javascript:toggle('unnamed-chunk-6');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-6" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flyls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">longevity</span> <span class="op">~</span> <span class="va">type</span> <span class="op">+</span> <span class="va">thorax</span> <span class="op">+</span> <span class="va">sleep</span>, data <span class="op">=</span> <span class="va">fruitfly</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">flyls</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = longevity ~ type + thorax + sleep, data = fruitfly)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -28.153  -6.836  -2.191   7.196  29.046 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     -56.04502   11.17882  -5.013 1.87e-06 ***
## typeInseminated   3.62796    2.77122   1.309    0.193    
## typeVirgin      -13.24603    2.76198  -4.796 4.70e-06 ***
## thorax          144.43008   13.11616  11.012  &lt; 2e-16 ***
## sleep            -0.05281    0.06383  -0.827    0.410    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 11.23 on 120 degrees of freedom
## Multiple R-squared:  0.6046, Adjusted R-squared:  0.5914 
## F-statistic: 45.88 on 4 and 120 DF,  p-value: &lt; 2.2e-16</code></pre>
<div id="section-3" class="section level4" number="19.2.0.1">
<h4>
<span class="header-section-number">19.2.0.1</span> <a class="anchor" aria-label="anchor" href="#section-3"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flyglm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">longevity</span> <span class="op">~</span> <span class="va">type</span> <span class="op">+</span> <span class="va">thorax</span> <span class="op">+</span> <span class="va">sleep</span>, 
             family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,
             data <span class="op">=</span> <span class="va">fruitfly</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">flyglm</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = longevity ~ type + thorax + sleep, family = gaussian(link = "identity"), 
##     data = fruitfly)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -28.153   -6.836   -2.191    7.196   29.046  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     -56.04502   11.17882  -5.013 1.87e-06 ***
## typeInseminated   3.62796    2.77122   1.309    0.193    
## typeVirgin      -13.24603    2.76198  -4.796 4.70e-06 ***
## thorax          144.43008   13.11616  11.012  &lt; 2e-16 ***
## sleep            -0.05281    0.06383  -0.827    0.410    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 126.0381)
## 
##     Null deviance: 38253  on 124  degrees of freedom
## Residual deviance: 15125  on 120  degrees of freedom
## AIC: 966.2
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>They are exactly the same. This is not surprising, as the maximum likelihood being fitted here is the same as an ordinary least squares model.</p>
</div>
</div>
</div>
</div>
</div>
<div id="workflow-for-fitting-a-glm" class="section level2" number="19.3">
<h2>
<span class="header-section-number">19.3</span> Workflow for fitting a GLM<a class="anchor" aria-label="anchor" href="#workflow-for-fitting-a-glm"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Exploratory data analysis</li>
<li>Choose suitable error term</li>
<li>Choose suitable mean function (and link function)</li>
<li>Fit model
<ul>
<li>Residual checks and model fit diagnostics</li>
<li>Revise model (transformations etc.)</li>
</ul>
</li>
<li>Model simplification if required</li>
<li>Check final model again</li>
</ul>
<div class="info">
<p>
When you transform your data e.g. with a log or sqrt, this changes the mean and variance at the same time (everything gets squished down). This might be fine, but can lead to difficult model fits if you need to reduce unequal variance but this leads to a change (often curvature) in the way the predictors fit to the response variable.
</p>
<p>
GLMs model the mean and variability independently. So a link function produces a transformation between predictors and the mean, and the relationship between the mean and data points is modeled separately.
</p>
</div>
</div>
<div id="poisson-regression-for-count-data-or-rate-data" class="section level2" number="19.4">
<h2>
<span class="header-section-number">19.4</span> Poisson regression (for count data or rate data)<a class="anchor" aria-label="anchor" href="#poisson-regression-for-count-data-or-rate-data"><i class="fas fa-link"></i></a>
</h2>
<p>Count or rate data are ubiquitous in the life sciences (e.g number of parasites per microlitre of blood, number of species counted in a particular area). These type of data are <strong>discrete</strong> and <strong>non-negative</strong>.
In such cases assuming our response variable to be normally distributed is not typically sensible.
The Poisson distribution lets us model count data explicitly.</p>
<p>Recall the simple linear regression case (i.e a GLM with a Gaussian error structure and identity link). For the sake of clarity let's consider a single explanatory variable where <span class="math inline">\(\mu\)</span> is the mean for <em>Y</em>:</p>
<p><span class="math display">\[
\begin{aligned}
\mu &amp; = \beta_0 + \beta_1X
\end{aligned}
\]</span></p>
<p>The mean function is <strong>unconstrained</strong>, i.e the value of <span class="math inline">\(\beta_0 + \beta_1X\)</span> can range from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(+\infty\)</span>. If we want to model count data we therefore want to <strong>constrain</strong> this mean to be positive only. Mathematically we can do this by taking the <strong>logarithm</strong> of the mean (the log is the default link for the Poisson distribution). We then assume our count data variance to be Poisson distributed (a discrete, non-negative distribution), to obtain our Poisson regression model (to be consistent with the statistics literature we will rename <span class="math inline">\(\mu\)</span> to <span class="math inline">\(\lambda\)</span>):</p>
<p><span class="math display">\[
\begin{aligned}
Y &amp; \sim \mathcal{Pois}(\lambda) \\
\log{\lambda} &amp; = \beta_0 + \beta_1X
\end{aligned}
\]</span></p>
<blockquote>
<p>Note - the relationship between the mean and the data is modelled by Poisson variance. The relationship between the predictors and the mean is modelled by a log transformation.</p>
</blockquote>
<p>The <strong>Poisson</strong> distribution has the following characteristics:</p>
<ul>
<li>
<strong>Discrete</strong> variable, defined on the range <span class="math inline">\(0, 1, \dots, \infty\)</span>.</li>
<li>A single <strong><em>rate</em></strong> parameter <span class="math inline">\(\lambda\)</span>, where <span class="math inline">\(\lambda &gt; 0\)</span>.</li>
<li>
<strong>Mean</strong> = <span class="math inline">\(\lambda\)</span><br>
</li>
<li>
<strong>Variance</strong> = <span class="math inline">\(\lambda\)</span>
</li>
</ul>
<p>So we model the variance as equal to the mean - as the mean increases so does the variance.</p>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="inline-figure"><img src="images/poisson.png" title="Poisson distribution on an exponential line" alt="Poisson distribution on an exponential line" width="80%" style="display: block; margin: auto;"></div>
<p>So for the Poisson regression case we assume that the mean and variance are the same.
Hence, as the mean <em>increases</em>, the variance <em>increases</em> also (<strong>heteroscedascity</strong>).
This may or may not be a sensible assumption so watch out! Just because a Poisson distribution <em>usually</em> fits well for count data, doesn't mean that a Gaussian distribution <em>can't</em> always work.</p>
<p>Recall the link function between the predictors and the mean and the rules of logarithms (if <span class="math inline">\(\log{\lambda} = k\)</span>(value of predictors), then <span class="math inline">\(\lambda = e^k\)</span>):</p>
<p><span class="math display">\[
\begin{aligned}
\log{\lambda} &amp; = \beta_0 + \beta_1X \\
\lambda &amp; = e^{\beta_0 + \beta_1X }
\end{aligned}
\]</span>
Thus we are effectively modelling the observed counts (on the original scale) using an exponential mean function.</p>
</div>
<div id="example-cuckoos" class="section level2" number="19.5">
<h2>
<span class="header-section-number">19.5</span> Example: Cuckoos<a class="anchor" aria-label="anchor" href="#example-cuckoos"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/cuckoo.jpg" width="100%" style="display: block; margin: auto;"></div>
<p>In a study by <a href="http://www.nature.com/nature/journal/v397/n6721/abs/397667a0.html">Kilner <em>et al.</em> (1999)</a>, the authors
studied the begging rate of nestlings in relation to total mass of the brood of <strong>reed warbler chicks</strong> and <strong>cuckoo chicks</strong>.
The question of interest is:</p>
<blockquote>
<p>How does nestling mass affect begging rates between the different species?</p>
</blockquote>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cuckoo</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"book"</span>, <span class="st">"files"</span>, <span class="st">"cuckoo.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<a href="https://raw.githubusercontent.com/UEABIO/data-sci-v1/main/book/files/cuckoo.csv">
<button class="btn btn-success"><i class="fa fa-save"></i> Download cuckoo data as csv</button>
</a>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cuckoo</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
Mass
</th>
<th style="text-align:right;">
Beg
</th>
<th style="text-align:left;">
Species
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
9.637522
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
<tr>
<td style="text-align:right;">
10.229151
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
<tr>
<td style="text-align:right;">
13.103706
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
<tr>
<td style="text-align:right;">
15.217391
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
<tr>
<td style="text-align:right;">
16.231884
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
<tr>
<td style="text-align:right;">
20.120773
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Cuckoo
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The data columns are:</p>
<ul>
<li>
<strong>Mass</strong>: nestling mass of chick in grams</li>
<li>
<strong>Beg</strong>: begging calls per 6 secs</li>
<li>
<strong>Species</strong>: Warbler or Cuckoo</li>
</ul>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cuckoo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Mass</span>, y<span class="op">=</span><span class="va">Beg</span>, colour<span class="op">=</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>There seem to be a relationship between mass and begging calls and it could
be different between species. It is tempting to fit a linear model to this data.
In fact, this is what the authors
of the original paper did; <strong>reed warbler chicks</strong> (solid circles, dashed fitted line) and
<strong>cuckoo chick</strong> (open circles, solid fitted line):</p>
<div class="inline-figure"><img src="images/original.png" width="100%" style="display: block; margin: auto;"></div>
<p>This model is inadequate. It is predicting <strong>negative</strong> begging calls <em>within</em> the
range of the observed data, which clearly does not make any sense.</p>
<p>Let us display the model diagnostics plots for this linear model.</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fit model</span>
<span class="co">## There is an interaction term here, it is reasonable to think that how calling rates change with size might be different between the two species.</span>
<span class="va">cuckoo_ls1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Beg</span> <span class="op">~</span> <span class="va">Mass</span><span class="op">+</span><span class="va">Species</span><span class="op">+</span><span class="va">Mass</span><span class="op">:</span><span class="va">Species</span>, data<span class="op">=</span><span class="va">cuckoo</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">cuckoo_ls1</span>, 
                         check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"homogeneity"</span>,
                                   <span class="st">"qq"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>The residuals plot depicts a strong "funnelling" effect, highlighting that the model assumptions are violated.
We should therefore try a different model structure.</p>
<p>The response variable in this case is a classic <strong>count data</strong>: <strong>discrete</strong> and bounded below by zero (i.e we cannot have negative counts). We will therefore try a <strong>Poisson model</strong> using the canonical <strong>log</strong> link function for the mean:</p>
<p><span class="math display">\[
    \log{\lambda} = \beta_0 + \beta_1 M_i + \beta_2 S_i + \beta_3 M_i S_i
\]</span></p>
<p>where <span class="math inline">\(M_i\)</span> is nestling mass and <span class="math inline">\(S_i\)</span> a <strong>dummy</strong> variable</p>
<p><span class="math display">\[
S_i = \left\{\begin{array}{ll}
        1 &amp; \mbox{if $i$ is warbler},\\
        0 &amp; \mbox{otherwise}.
        \end{array}
        \right.
\]</span></p>
<p>The term <span class="math inline">\(M_iS_i\)</span> is an <strong>interaction</strong> term. Think of this as an additional explanatory variable in our model.
Effectively it lets us have <strong>different</strong> slopes for different species (without an interaction term we assume that
both species have the same slope for the relationship between begging rate and mass, and only the intercept differ).</p>
<p>The mean regression lines for the two species look like this:</p>
<ul>
<li>
<strong>Cuckoo</strong> (<span class="math inline">\(S_i=0\)</span>)</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
    \log{\lambda} &amp; = \beta_0 + \beta_1 M_i + (\beta_2 \times 0)  + (\beta_3 \times M_i \times 0)\\
    \log{\lambda} &amp; = \beta_0 + \beta_1 M_i
\end{aligned}
\]</span></p>
<ul>
<li><p><strong>Intercept</strong> = <span class="math inline">\(\beta_0\)</span>, <strong>Gradient</strong> = <span class="math inline">\(\beta_1\)</span></p></li>
<li><p><strong>Warbler</strong> (<span class="math inline">\(S_i=1\)</span>)</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
    \log{\lambda} &amp; = \beta_0 + \beta_1 M_i + (\beta_2 \times 1)  + (\beta_3 \times M_i \times 1)\\
    \log{\lambda} &amp; = \beta_0 + \beta_1 M_i + \beta_2 + \beta_3M_i\\
\end{aligned}
\]</span></p>
<p>Fit the model with the interaction term in R:</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cuckoo_glm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Beg</span> <span class="op">~</span> <span class="va">Mass</span> <span class="op">+</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Mass</span><span class="op">:</span><span class="va">Species</span>, data<span class="op">=</span><span class="va">cuckoo</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Beg ~ Mass + Species + Mass:Species, family = poisson(link = "log"), 
##     data = cuckoo)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -7.5178  -2.8298  -0.6672   1.5564   6.0631  
## 
## Coefficients:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          0.334475   0.227143   1.473  0.14088    
## Mass                 0.094847   0.007261  13.062  &lt; 2e-16 ***
## SpeciesWarbler       0.674820   0.259217   2.603  0.00923 ** 
## Mass:SpeciesWarbler -0.021673   0.008389  -2.584  0.00978 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 970.08  on 50  degrees of freedom
## Residual deviance: 436.05  on 47  degrees of freedom
## AIC: 615.83
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<blockquote>
<p>Note there appears to be a negative interaction effect for Species:Mass, indicating that Begging calls do not increase with mass as much as you would expect for Warblers as compared to Cuckoos.</p>
</blockquote>
<p>##Activity 1: Plot the mean regression line for each species:</p>
<p>Hint: Use <code><a href="https://generics.r-lib.org/reference/augment.html">broom::augment</a></code>. If we fit the model on the log scale, then we get the fitted generalized linear response (Y is on a log scale). The lines will be straight. We get an exponential curve in the scale of the original data, if we specify <code>type.predict = response</code> which is the <strong>same</strong> as a straight line in the log-scaled version of the data. Try both:</p>
<div id="variable-scale" class="section level3" number="19.5.1">
<h3>
<span class="header-section-number">19.5.1</span> Variable scale<a class="anchor" aria-label="anchor" href="#variable-scale"><i class="fas fa-link"></i></a>
</h3>
<button id="displayTextunnamed-chunk-20" onclick="javascript:toggle('unnamed-chunk-20');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-20" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># using augment allows you to generate fitted outcomes from the regression, make sure to set the predictions onto the response scale in order to 'back transform` the data onto the original scale</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span>, type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Mass</span>, y<span class="op">=</span><span class="va">.fitted</span>, colour<span class="op">=</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green3"</span>,<span class="st">"turquoise3"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-57-1.png" width="100%" style="display: block; margin: auto;">
</div>
</div>
</div>
</div>
<div id="log-scale" class="section level3" number="19.5.2">
<h3>
<span class="header-section-number">19.5.2</span> Log scale<a class="anchor" aria-label="anchor" href="#log-scale"><i class="fas fa-link"></i></a>
</h3>
<button id="displayTextunnamed-chunk-21" onclick="javascript:toggle('unnamed-chunk-21');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-21" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Mass</span>, y<span class="op">=</span><span class="va">.fitted</span>, colour<span class="op">=</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green3"</span>,<span class="st">"turquoise3"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-58-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
</div>
<p>Compare the new Poisson model fits to the ordinary least squares model. We can see that although the homogeneity of variance is far from perfect, the curvature in the model has been drastically reduced (this makes sense as now we have a model fitted to exponential data), and the qqplot is within acceptable confidence intervals.</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span>, 
                         check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"homogeneity"</span>,
                                   <span class="st">"qq"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-22-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Beg ~ Mass + Species + Mass:Species, family = poisson(link = "log"), 
##     data = cuckoo)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -7.5178  -2.8298  -0.6672   1.5564   6.0631  
## 
## Coefficients:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          0.334475   0.227143   1.473  0.14088    
## Mass                 0.094847   0.007261  13.062  &lt; 2e-16 ***
## SpeciesWarbler       0.674820   0.259217   2.603  0.00923 ** 
## Mass:SpeciesWarbler -0.021673   0.008389  -2.584  0.00978 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 970.08  on 50  degrees of freedom
## Residual deviance: 436.05  on 47  degrees of freedom
## AIC: 615.83
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>A reminder of how to interpret the regression coefficients of a model with an interaction term</p>
<ul>
<li><p>Intercept = <span class="math inline">\(\beta 0\)</span> (intercept for the <strong>reference or baseline</strong> so here the <strong>log</strong> of the mean number of begging calls for <strong>cuckoos</strong> when mass is 0)</p></li>
<li><p>Mass = <span class="math inline">\(\beta1\)</span> (slope: the change in the <strong>log</strong> mean count of begging calls for every gram of bodyweight for <strong>cuckoos</strong>)</p></li>
<li><p>SpeciesWarbler = <span class="math inline">\(\beta2\)</span> (the <strong>log</strong> mean increase/decrease in begging call rate of the <strong>warblers</strong> relative to cuckoos)</p></li>
<li><p>Mass:SpeciesWarbler =<span class="math inline">\(\beta3\)</span> (the <strong>log</strong> mean increase/decrease in the <strong>slope</strong> for <strong>warblers</strong> relative to cuckoos)</p></li>
</ul>
<div class="info">
<p>
Because this is a Poisson distribution where variance is fixed with the mean we are using z scores. Estimates are on a log scale because of the link function - this means so are any S.E. or confidence intervals
</p>
</div>
</div>
</div>
<div id="estimates-and-intervals" class="section level2" number="19.6">
<h2>
<span class="header-section-number">19.6</span> Estimates and Intervals<a class="anchor" aria-label="anchor" href="#estimates-and-intervals"><i class="fas fa-link"></i></a>
</h2>
<p>Remember that not only is this <strong>Poisson</strong> model fitting variance using a Poisson and not Normal distribution. It is also relating the predictors to the response variable with a "<em>log-link</em>" this means we need to exponentiate our estimates to get them on the same scale as the response (y) variable. Until you do this all the model estimates are logn(y).</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">### Intercept - Incidence rate at Mass=0, and Species = Cuckoo</span>

<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co">### Change in the average incidence rate with Mass </span>

<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="co">### Change in the incidence rate intercept when Species = Warbler and Mass = 0</span>
 
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="co">### The extra change in incidence rate for each unit increase in Mass when Species = Warbler (the interaction effect)</span></code></pre></div>
<pre><code>## (Intercept) 
##    1.397207 
##    Mass 
## 1.09949 
## SpeciesWarbler 
##       1.963679 
## Mass:SpeciesWarbler 
##           0.9785598</code></pre>
<p>Luckily when you tidy your models up with <code>broom</code> you can specify that you want to put model predictions on the <em>response</em> variable scale by specifying <code>exponentiate = T</code> which will remove the log transformation, and allow easy calculation of confidence intervals.</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span>, 
            exponentiate <span class="op">=</span> <span class="cn">T</span>, 
            conf.int <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
1.3972071
</td>
<td style="text-align:right;">
0.2271431
</td>
<td style="text-align:right;">
1.472531
</td>
<td style="text-align:right;">
0.1408775
</td>
<td style="text-align:right;">
0.8858795
</td>
<td style="text-align:right;">
2.1589962
</td>
</tr>
<tr>
<td style="text-align:left;">
Mass
</td>
<td style="text-align:right;">
1.0994905
</td>
<td style="text-align:right;">
0.0072615
</td>
<td style="text-align:right;">
13.061667
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1.0841087
</td>
<td style="text-align:right;">
1.1154266
</td>
</tr>
<tr>
<td style="text-align:left;">
SpeciesWarbler
</td>
<td style="text-align:right;">
1.9636787
</td>
<td style="text-align:right;">
0.2592166
</td>
<td style="text-align:right;">
2.603304
</td>
<td style="text-align:right;">
0.0092330
</td>
<td style="text-align:right;">
1.1889064
</td>
<td style="text-align:right;">
3.2864493
</td>
</tr>
<tr>
<td style="text-align:left;">
Mass:SpeciesWarbler
</td>
<td style="text-align:right;">
0.9785598
</td>
<td style="text-align:right;">
0.0083890
</td>
<td style="text-align:right;">
-2.583559
</td>
<td style="text-align:right;">
0.0097787
</td>
<td style="text-align:right;">
0.9625068
</td>
<td style="text-align:right;">
0.9946969
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="interpretation" class="section level3" number="19.6.1">
<h3>
<span class="header-section-number">19.6.1</span> Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"><i class="fas fa-link"></i></a>
</h3>
<p>It is <strong>very important</strong> to remember whether you are describing the results on the log-link scale or the original scale. It would usually make more sense to provide answers on the original scale, but this means you must first exponentiate the relationship between response predictors as described above when writing the results.</p>
<div class="warning">
<p>
The default coefficients from the model summary are on a log scale, and are additive as such these can be added and subtracted from each other (just like ordinary least squares regression) to work out log-estimates. BUT if you exponentiate the terms of the model you get values on the 'response' scale, but these are now changes in 'rate' and are multiplicative.
</p>
<p>
Also remember that as Poisson models have 'fixed variance' z- and Chisquare distributions are used instead of t- and F.
</p>
</div>
<p>In this example we wished to infer the relationship between begging rates and mass in these two species.</p>
<p>I hypothesised that the rate of begging in chicks would increase as their body size increased. Interestingly I found there was a significant interaction effect with mass and species, where Warbler chicks increased their calling rate with mass at a rate that was only 0.98 [95%CI: 0.96-0.99] that of Cuckoo chicks (Poisson GLM: <span class="math inline">\(\chi^2\)</span><sub>1,47</sub> = 6.77, <em>P</em> = 0.009). This meant that while at hatching Warbler chicks start with a mean call rate that is higher than their parasitic brood mates, this quickly reverses as they grow.</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># For a fixed  mean-variance model we use a Chisquare distribution</span>
<span class="fu"><a href="https://rdrr.io/r/stats/add1.html">drop1</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span>

<span class="co"># emmeans can be another handy function - if you specify response then here it provideds the average call rate for each species, at the average value for any continuous measures - so here the average call rate for both species at an average body mass of 20.3</span>

<span class="fu">emmeans</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">cuckoo_glm1</span>, specs <span class="op">=</span> <span class="op">~</span> <span class="va">Species</span><span class="op">:</span><span class="va">Mass</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Df
</th>
<th style="text-align:right;">
Deviance
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
LRT
</th>
<th style="text-align:right;">
Pr(&gt;Chi)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
&lt;none&gt;
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
436.0458
</td>
<td style="text-align:right;">
615.8282
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Mass:Species
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
442.8118
</td>
<td style="text-align:right;">
620.5942
</td>
<td style="text-align:right;">
6.765991
</td>
<td style="text-align:right;">
0.0092911
</td>
</tr>
</tbody>
</table></div>
</div>
<pre><code>##  Species Mass  rate    SE  df asymp.LCL asymp.UCL
##  Cuckoo  20.3  9.61 0.884 Inf      8.03      11.5
##  Warbler 20.3 12.15 0.658 Inf     10.93      13.5
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
</div>
</div>
<div id="overdispersion" class="section level2" number="19.7">
<h2>
<span class="header-section-number">19.7</span> Overdispersion<a class="anchor" aria-label="anchor" href="#overdispersion"><i class="fas fa-link"></i></a>
</h2>
<p>There is one <strong>extra</strong> check we need to apply to a Poisson model and that's for <strong>overdispersion</strong></p>
<p>Poisson (and binomial models) assume that the variance is <em>equal to the mean.</em></p>
<p>However, if there is <strong>residual deviance that is bigger than the residual degrees of freedom</strong> then there is <em>more</em> variance than we expect from the prediction of the mean by our model.</p>
<p>Overdispersion in Poisson models can be diagnosed by <span class="math inline">\(\frac{residual~deviance}{residual~degrees~of~freedom}\)</span> which from our example here 'summary()' is <span class="math inline">\(\frac{436}{47} = 9.3\)</span></p>
<p>Overdispersion statistic values <strong>&gt; 1 = Overdispersed</strong></p>
<p>Overdispersion is a result of larger than expected variance for that mean under a Poisson distribution, this is clearly an issue with our model!</p>
<p>Luckily a simple fix is to fit a <em>quasi-likelihood</em> model which accounts for this, think of "quasi" as "sort of but not completely" Poisson.</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cuckoo_glm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Beg</span> <span class="op">~</span> <span class="va">Mass</span><span class="op">+</span><span class="va">Species</span><span class="op">+</span><span class="va">Mass</span><span class="op">:</span><span class="va">Species</span>, data<span class="op">=</span><span class="va">cuckoo</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cuckoo_glm2</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Beg ~ Mass + Species + Mass:Species, family = quasipoisson(link = "log"), 
##     data = cuckoo)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -7.5178  -2.8298  -0.6672   1.5564   6.0631  
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          0.33448    0.63129   0.530    0.599    
## Mass                 0.09485    0.02018   4.700  2.3e-05 ***
## SpeciesWarbler       0.67482    0.72043   0.937    0.354    
## Mass:SpeciesWarbler -0.02167    0.02332  -0.930    0.357    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for quasipoisson family taken to be 7.7242)
## 
##     Null deviance: 970.08  on 50  degrees of freedom
## Residual deviance: 436.05  on 47  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>As you can see, while none of the estimates have changed, the standard errors (and therefore our confidence intervals) have, this accounts for the greater than expected uncertainty we saw with the deviance, and applies a more cautious estimate of uncertainty. The interaction effect appears to no longer be significant at <span class="math inline">\(\alpha\)</span> = 0.05, now that we have wider standard errors.</p>
<div class="warning">
<p>
Because we are now estimating the variance again, the test statistics have reverted to <em>t</em> distributions and anova and drop1 functions should specify the F-test again.
</p>
</div>
</div>
<div id="activity-2-write-up" class="section level2" number="19.8">
<h2>
<span class="header-section-number">19.8</span> Activity 2: Write-up<a class="anchor" aria-label="anchor" href="#activity-2-write-up"><i class="fas fa-link"></i></a>
</h2>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
How would you write up an Analysis Methods section?
</div>
</div>
<button id="displayTextunnamed-chunk-32" onclick="javascript:toggle('unnamed-chunk-32');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-32" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<p>I used a Poisson log-link Generalized Linear Model with quasi-likelihoods to account for overdispersion to analyse begging call rates in Warbler and Cuckoo chicks. The species of chick was included as a categorical predictor and mass was included as a continuous predictor.</p>
<p>The initial model also included an interaction term between species and mass, but this was removed from the final model as removal of this term did not significantly alter the fit of the model (ANOVA).</p>
All analyses were carried out in R (ver 4.1.3) (R Core Team 2021) with the following packages; tidyverse (Wickham et al 2019), performance (Lüdecke et al 2021) for checking model assumptions, and MASS (Venables &amp; Ripley 2002) for model comparisons.
</div>
</div>
</div>
</div>
<div id="logistic-regression-for-binary-data" class="section level2" number="19.9">
<h2>
<span class="header-section-number">19.9</span> Logistic regression (for binary data)<a class="anchor" aria-label="anchor" href="#logistic-regression-for-binary-data"><i class="fas fa-link"></i></a>
</h2>
<p>When our response variable is binary, we can use a glm with a <strong>binomial</strong> error distribution</p>
<p>So far we have only considered continuous and discrete data as response variables. What if our response is a categorical variable (e.g passing or failing an exam, voting yes or no in a referendum, whether an egg has successfully fledged or been predated, infected/uninfected, alive/dead)?</p>
<p>We can model the <strong>probability</strong> <span class="math inline">\(p\)</span> of being in a particular class as a function of other
explanatory variables.</p>
<p>These type of <strong>binary</strong> data are assumed to follow a <strong>Bernoulli</strong> distribution (which is a special case of <em>Binomial</em>) which has the following characteristics:</p>
<p><span class="math display">\[
Y \sim \mathcal{Bern}(p)
\]</span></p>
<ul>
<li>
<strong>Binary</strong> variable, taking the values 0 or 1 (yes/no, pass/fail).</li>
<li>A <strong>probability</strong> parameter <span class="math inline">\(p\)</span>, where <span class="math inline">\(0 &lt; p &lt; 1\)</span>.</li>
<li>
<strong>Mean</strong> = <span class="math inline">\(p\)</span><br>
</li>
<li>
<strong>Variance</strong> = <span class="math inline">\(p(1 - p)\)</span>
</li>
</ul>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/bernplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Let us now place the Gaussian (simple linear regression), Poisson and logistic models next to each other:</p>
<p><span class="math display">\[
\begin{aligned}
Y &amp; \sim \mathcal{N}(\mu, \sigma^2) &amp;&amp;&amp; Y  \sim \mathcal{Pois}(\lambda) &amp;&amp;&amp; Y  \sim \mathcal{Bern}(p)\\
\mu &amp; = \beta_0 + \beta_1X &amp;&amp;&amp; \log{\lambda} = \beta_0 + \beta_1X &amp;&amp;&amp; ?? = \beta_0 + \beta_1X
\end{aligned}
\]</span></p>
<p>Now we need to fill in the <code>??</code> with the appropriate term. Similar to the Poisson regression case,
we cannot simply model the probabiliy as <span class="math inline">\(p = \beta_0 + \beta_1X\)</span>, because <span class="math inline">\(p\)</span> <strong>cannot</strong> be negative.
<span class="math inline">\(\log{p} = \beta_0 + \beta_1X\)</span> won't work either, because <span class="math inline">\(p\)</span> cannot be greater than 1. Instead we
model the <strong>log odds</strong> <span class="math inline">\(\log\left(\frac{p}{1 - p}\right)\)</span> as a linear function. So our logistic regression model looks
like this:</p>
<p><span class="math display">\[
\begin{aligned}
Y  &amp; \sim \mathcal{Bern}(p)\\
\log\left(\frac{p}{1 - p}\right) &amp;  = \beta_0 + \beta_1 X
\end{aligned}
\]</span></p>
<p>Again, note that we are still "only" fitting straight lines through our data, but this time in the log odds space.
As a shorthand notation we write <span class="math inline">\(\log\left(\frac{p}{1 - p}\right) = \text{logit}(p) = \beta_0 + \beta_1 X\)</span>.</p>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-33-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>We can also re-arrange the above equation so that we get an expression for <span class="math inline">\(p\)</span></p>
<p><span class="math display">\[
p = \frac{e^{\beta_0 + \beta_1 X}}{1 + e^{\beta_0 + \beta_1 X}}
\]</span></p>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-34-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Note how <span class="math inline">\(p\)</span> can only vary between 0 and 1.</p>
<p>To implement the logistic regression model in R, we choose <code>family=binomial(link=logit)</code> (the Bernoulli distribution is a special case of the Binomial distribution).</p>
<pre><code><a href="https://rdrr.io/r/stats/glm.html">glm(response ~ explanatory, family=binomial(link=logit))</a></code></pre>
<div class="inline-figure"><img src="images/space-shuttle.jpg" title="Space shuttle at launch" alt="Space shuttle at launch" width="80%" style="display: block; margin: auto;"></div>
<p><a href="https://en.wikipedia.org/wiki/Space_Shuttle_Challenger_disaster#O-ring_concerns">The Challenger Disaster</a></p>
<p>In 1985, NASA made the decision to send the first civilian into space.</p>
<p>This decision brought a huge amount of public attention to the STS-51-L mission, which would be Challenger’s 25th trip to space and school teacher Christa McAuliffe’s 1st. On the afternoon of January 28th, 1986 students around America tuned in to watch McAuliffe and six other astronauts launch from Cape Canaveral, Florida. 73 seconds into the flight, the shuttle experienced a critical failure and broke apart in mid air, resulting in the deaths of all seven crewmembers: Christa McAuliffe, Dick Scobee, Judy Resnik, Ellison Onizuka, Ronald McNair, Gregory Jarvis, and Michael Smith.</p>
<p>After an investigation into the incident, it was discovered that the failure was caused by an O-ring in the solid rocket booster. Additionally, it was revealed that such an incident was foreseeable.</p>
<p>In this half of the worksheet we will discuss how the right statistical model could have predicted the critical failure of an O-ring on that day.</p>
<a href="https://raw.githubusercontent.com/UEABIO/data-sci-v1/main/book/files/Challenger.csv">
<button class="btn btn-success"><i class="fa fa-save"></i> Download Challenger data as csv</button>
</a>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">challenger</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
oring_tot
</th>
<th style="text-align:right;">
oring_dt
</th>
<th style="text-align:right;">
temp
</th>
<th style="text-align:right;">
flight
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The data columns are:</p>
<ul>
<li><p><strong>oring_tot</strong>: Total number of orings on the flight</p></li>
<li><p><strong>oring_dt</strong> : number of orings that failed during a flight</p></li>
<li><p><strong>temp</strong>: Outside temperature on the date of the flight</p></li>
<li><p><strong>flight</strong> order of flights</p></li>
</ul>
<p>It was frequently discussed issue that temperature might play a role in the critical safety of the o-rings on the shuttles.
One of the biggest mistakes made in assessing the flight risk for the Challenger was to only look at the flights <strong>where a failure had occurred</strong></p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">challenger</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">oring_dt</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">oring_dt</span>, x<span class="op">=</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Temperature on flight launches where an O-ring incident occurred"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-39-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>From this it was concluded that temperature did not appear to affect o-ring risk of failure, as o-ring failures were detected at a range of different temperatures.</p>
<p>However when we compare this to the full data that was available a very different picture emerges.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">challenger</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">oring_dt</span>, 
           x<span class="op">=</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"All launch data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-40-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>When we include the flights without incident <em>and</em> those with incident, we can see that there is a very clear relationship between temperature and the risk of an o-ring failure. It has been argued that the clear presentation of this data should have allowed even the casual observer to determine the high risk of disaster.</p>
<p>However if we want to understand the actual relationship between temperature and risk then there are several issues with fitting a linear model here - once again the data is an integer, and bounded by zero (our model predicts negative failure rates within the observed data range).</p>
<p>We COULD consider this as suitable for a Poisson model - but if we are really interested in determining the binary risk of <strong>having a flight with o-ring failure vs. no failure</strong>. Then we should implement a GLM with a Binomial distribution.</p>
<p>We can use dplyr to generate a binary column of no incident '0' and fail '1' for anything &gt;0.</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">challenger</span> <span class="op">&lt;-</span> <span class="va">challenger</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>oring_binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">oring_dt</span> <span class="op">==</span><span class="st">'0'</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Fitting a binary GLM</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">oring_binary</span><span class="op">~</span><span class="va">temp</span>, family<span class="op">=</span><span class="va">binomial</span>, data<span class="op">=</span><span class="va">challenger</span><span class="op">)</span>
<span class="va">binary_model</span> <span class="op">%&gt;%</span> 
  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>conf.int<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
23.7749552
</td>
<td style="text-align:right;">
11.8203514
</td>
<td style="text-align:right;">
2.011358
</td>
<td style="text-align:right;">
0.0442877
</td>
<td style="text-align:right;">
7.2430347
</td>
<td style="text-align:right;">
58.1947978
</td>
</tr>
<tr>
<td style="text-align:left;">
temp
</td>
<td style="text-align:right;">
-0.3667009
</td>
<td style="text-align:right;">
0.1751673
</td>
<td style="text-align:right;">
-2.093432
</td>
<td style="text-align:right;">
0.0363106
</td>
<td style="text-align:right;">
-0.8772585
</td>
<td style="text-align:right;">
-0.1217173
</td>
</tr>
</tbody>
</table></div>
</div>
<p>So we are now fitting the following model</p>
<p><span class="math display">\[
 Y \sim Bern(p)
\]</span>
<span class="math display">\[
\log\left[ \frac { P( \operatorname{oring\_binary} = fail) }{ 1 - P( \operatorname{oring\_binary} = fail) } \right] = \beta_{0} + \beta_{1}(\operatorname{temp})
\]</span></p>
<p>Which in R will look like this:</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">oring_binary</span><span class="op">~</span><span class="va">temp</span>, family<span class="op">=</span><span class="va">binomial</span>, data<span class="op">=</span><span class="va">challenger</span><span class="op">)</span></code></pre></div>
<ul>
<li>Intercept = <span class="math inline">\(\beta_{0}\)</span> = 23.77</li>
</ul>
<p>When the temperature is 0°F the mean <em>log-odds</em> are 23.77 [95%CI: 7.24- 58.19] for a failure incident in the O-rings</p>
<ul>
<li>Temp = <span class="math inline">\(\beta_{1}\)</span> = -0.37 [95%CI: -0.87 - -0.12]</li>
</ul>
<p>For every rise in the temperature by 1°F, the <em>log-odds</em> of a critical incident fall by 0.37.</p>
<div id="interpreting-model-coefficients" class="section level3" number="19.9.1">
<h3>
<span class="header-section-number">19.9.1</span> Interpreting model coefficients<a class="anchor" aria-label="anchor" href="#interpreting-model-coefficients"><i class="fas fa-link"></i></a>
</h3>
<p>We first consider why we are dealing with odds <span class="math inline">\(\frac{p}{1-p}\)</span> instead of just <span class="math inline">\(p\)</span>. They contain the same information, so the choice is somewhat arbitrary, however we’ve been using probabilities for so long that it feels unnatural to switch to odds. There are good reasons for this, however. Odds <span class="math inline">\(\frac{p}{1-p}\)</span> can take on any value from 0 to ∞ and so part of our translation of <span class="math inline">\(p\)</span> to an unrestricted domain is already done (<span class="math inline">\(P\)</span> is restricted to 0-1). Take a look at some examples below:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="51%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th>Probability</th>
<th>Odds</th>
<th>Verbiage</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(p=.95\)</span></td>
<td><span class="math inline">\(\frac{95}{5} = \frac{19}{1} = 19\)</span></td>
<td>19 to 1 odds for</td>
</tr>
<tr class="even">
<td><span class="math inline">\(p=.75\)</span></td>
<td><span class="math inline">\(\frac{75}{25} = \frac{3}{1} = 3\)</span></td>
<td>3 to 1 odds for</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(p=.50\)</span></td>
<td><span class="math inline">\(\frac{50}{50} = \frac{1}{1} = 1\)</span></td>
<td>1 to 1 odds</td>
</tr>
<tr class="even">
<td><span class="math inline">\(p=.25\)</span></td>
<td><span class="math inline">\(\frac{25}{75} = \frac{1}{3} = 0.33\)</span></td>
<td>3 to 1 odds against</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(p=.05\)</span></td>
<td><span class="math inline">\(\frac{95}{5} = \frac{1}{19} = 0.0526\)</span></td>
<td>19 to 1 odds against</td>
</tr>
</tbody>
</table></div>
<p>When we use a binomial model, we produce the 'log-odds', this produces a fully unconstrained linear regression as anything less than 1, can now occupy an infinite negative value -∞ to ∞.</p>
<p><span class="math display">\[\log\left(\frac{p}{1-p}\right)    =   \beta_{0}+\beta_{1}x_{1}+\beta_{2}x_{2}
\]</span></p>
<p><span class="math display">\[\frac{p}{1-p} =   e^{\beta_{0}}e^{\beta_{1}x_{1}}e^{\beta_{2}x_{2}}
\]</span></p>
<p>We can interpret <span class="math inline">\(\beta_{1}\)</span> and <span class="math inline">\(\beta_{2}\)</span> as the increase in the log odds for every unit increase in <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span>. We could alternatively interpret <span class="math inline">\(\beta_{1}\)</span> and <span class="math inline">\(\beta_{2}\)</span> using the notion that a one unit change in <span class="math inline">\(x_{1}\)</span> as a percent change of <span class="math inline">\(e^{\beta_{1}}\)</span> in the odds. That is to say, <span class="math inline">\(e^{\beta_{1}}\)</span> is the odds ratio of that change.</p>
<p>If you want to find out more about <a href="https://www.youtube.com/watch?v=8nm0G-1uJzA">Odds and log-odds head here</a></p>
</div>
</div>
<div id="probability" class="section level2" number="19.10">
<h2>
<span class="header-section-number">19.10</span> Probability<a class="anchor" aria-label="anchor" href="#probability"><i class="fas fa-link"></i></a>
</h2>
<p>A powerful use of logisitic regression is prediction. Can we predict the probability of an event occuring using our data?</p>
<div id="activity-3-make-predictions" class="section level3" number="19.10.1">
<h3>
<span class="header-section-number">19.10.1</span> Activity 3: Make predictions<a class="anchor" aria-label="anchor" href="#activity-3-make-predictions"><i class="fas fa-link"></i></a>
</h3>
<p>Can you use our prediction functions <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> or <code><a href="https://generics.r-lib.org/reference/augment.html">broom::augment()</a></code> to look at the models predictions for O-ring failure in our data? Bonus points if you can convert log-odds to probability?</p>
<button id="displayTextunnamed-chunk-44" onclick="javascript:toggle('unnamed-chunk-44');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-44" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="tab">
<button class="tablinksunnamed-chunk-44 active" onclick="javascript:openCode(event, 'option1unnamed-chunk-44', 'unnamed-chunk-44');">
Base R
</button>
<button class="tablinksunnamed-chunk-44" onclick="javascript:openCode(event, 'option2unnamed-chunk-44', 'unnamed-chunk-44');">
<tt>tidyverse</tt>
</button>
</div>
<div id="option1unnamed-chunk-44" class="tabcontentunnamed-chunk-44">
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">binary_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## 0.394769696 0.130776531 0.178373050 0.238538593 0.311308842 0.067388639 
##           7           8           9          10          11          12 
## 0.047687994 0.130776531 0.946495574 0.662129014 0.130776531 0.007941202 
##          13          14          15          16          17          18 
## 0.311308842 0.987128767 0.311308842 0.023485304 0.130776531 0.002657203 
##          19          20          21          22          23 
## 0.016393905 0.005516836 0.023485304 0.016393905 0.924582363</code></pre>
</div>
<div id="option2unnamed-chunk-44" class="tabcontentunnamed-chunk-44">
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">binary_model</span>, 
               type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
oring_binary
</th>
<th style="text-align:right;">
temp
</th>
<th style="text-align:right;">
.fitted
</th>
<th style="text-align:right;">
.resid
</th>
<th style="text-align:right;">
.std.resid
</th>
<th style="text-align:right;">
.hat
</th>
<th style="text-align:right;">
.sigma
</th>
<th style="text-align:right;">
.cooksd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
0.3947697
</td>
<td style="text-align:right;">
-1.0021439
</td>
<td style="text-align:right;">
-1.0690274
</td>
<td style="text-align:right;">
0.1212153
</td>
<td style="text-align:right;">
0.8149531
</td>
<td style="text-align:right;">
0.0511900
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
2.0170599
</td>
<td style="text-align:right;">
2.0974690
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.7080401
</td>
<td style="text-align:right;">
0.2922222
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.1783731
</td>
<td style="text-align:right;">
-0.6268474
</td>
<td style="text-align:right;">
-0.6527589
</td>
<td style="text-align:right;">
0.0778149
</td>
<td style="text-align:right;">
0.8366510
</td>
<td style="text-align:right;">
0.0099323
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
0.2385386
</td>
<td style="text-align:right;">
-0.7382625
</td>
<td style="text-align:right;">
-0.7713137
</td>
<td style="text-align:right;">
0.0838649
</td>
<td style="text-align:right;">
0.8315908
</td>
<td style="text-align:right;">
0.0156510
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
0.0673886
</td>
<td style="text-align:right;">
-0.3735417
</td>
<td style="text-align:right;">
-0.3872542
</td>
<td style="text-align:right;">
0.0695651
</td>
<td style="text-align:right;">
0.8448617
</td>
<td style="text-align:right;">
0.0029032
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0.0476880
</td>
<td style="text-align:right;">
-0.3126102
</td>
<td style="text-align:right;">
-0.3232178
</td>
<td style="text-align:right;">
0.0645605
</td>
<td style="text-align:right;">
0.8462069
</td>
<td style="text-align:right;">
0.0018473
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
-0.5294432
</td>
<td style="text-align:right;">
-0.5505492
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.8403180
</td>
<td style="text-align:right;">
0.0066147
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.9464956
</td>
<td style="text-align:right;">
0.3316293
</td>
<td style="text-align:right;">
0.3684596
</td>
<td style="text-align:right;">
0.1899238
</td>
<td style="text-align:right;">
0.8452819
</td>
<td style="text-align:right;">
0.0081803
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0.6621290
</td>
<td style="text-align:right;">
0.9080692
</td>
<td style="text-align:right;">
1.0360335
</td>
<td style="text-align:right;">
0.2317717
</td>
<td style="text-align:right;">
0.8170810
</td>
<td style="text-align:right;">
0.1001978
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
2.0170599
</td>
<td style="text-align:right;">
2.0974690
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.7080401
</td>
<td style="text-align:right;">
0.2922222
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
0.0079412
</td>
<td style="text-align:right;">
-0.1262767
</td>
<td style="text-align:right;">
-0.1282707
</td>
<td style="text-align:right;">
0.0308485
</td>
<td style="text-align:right;">
0.8488032
</td>
<td style="text-align:right;">
0.0001315
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
0.9871288
</td>
<td style="text-align:right;">
0.1609645
</td>
<td style="text-align:right;">
0.1683888
</td>
<td style="text-align:right;">
0.0862364
</td>
<td style="text-align:right;">
0.8484526
</td>
<td style="text-align:right;">
0.0006733
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0.0234853
</td>
<td style="text-align:right;">
-0.2180160
</td>
<td style="text-align:right;">
-0.2238281
</td>
<td style="text-align:right;">
0.0512601
</td>
<td style="text-align:right;">
0.8478117
</td>
<td style="text-align:right;">
0.0006848
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
-0.5294432
</td>
<td style="text-align:right;">
-0.5505492
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.8403180
</td>
<td style="text-align:right;">
0.0066147
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
0.0026572
</td>
<td style="text-align:right;">
-0.0729485
</td>
<td style="text-align:right;">
-0.0735502
</td>
<td style="text-align:right;">
0.0162947
</td>
<td style="text-align:right;">
0.8491284
</td>
<td style="text-align:right;">
0.0000224
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.0163939
</td>
<td style="text-align:right;">
-0.1818228
</td>
<td style="text-align:right;">
-0.1859683
</td>
<td style="text-align:right;">
0.0440855
</td>
<td style="text-align:right;">
0.8482690
</td>
<td style="text-align:right;">
0.0004021
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
0.0055168
</td>
<td style="text-align:right;">
-0.1051866
</td>
<td style="text-align:right;">
-0.1065392
</td>
<td style="text-align:right;">
0.0252300
</td>
<td style="text-align:right;">
0.8489535
</td>
<td style="text-align:right;">
0.0000737
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0.0234853
</td>
<td style="text-align:right;">
-0.2180160
</td>
<td style="text-align:right;">
-0.2238281
</td>
<td style="text-align:right;">
0.0512601
</td>
<td style="text-align:right;">
0.8478117
</td>
<td style="text-align:right;">
0.0006848
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.0163939
</td>
<td style="text-align:right;">
-0.1818228
</td>
<td style="text-align:right;">
-0.1859683
</td>
<td style="text-align:right;">
0.0440855
</td>
<td style="text-align:right;">
0.8482690
</td>
<td style="text-align:right;">
0.0004021
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
0.9245824
</td>
<td style="text-align:right;">
0.3960130
</td>
<td style="text-align:right;">
0.4481860
</td>
<td style="text-align:right;">
0.2192676
</td>
<td style="text-align:right;">
0.8433540
</td>
<td style="text-align:right;">
0.0146713
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<script> javascript:hide('option2unnamed-chunk-44') </script>
</div>
</div>
</div>
</div>
<div id="emmeans-1" class="section level3" number="19.10.2">
<h3>
<span class="header-section-number">19.10.2</span> Emmeans<a class="anchor" aria-label="anchor" href="#emmeans-1"><i class="fas fa-link"></i></a>
</h3>
<p>If we use the <code><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans()</a></code> function it will convert <em>log-odds</em> to estimate the probability of o-ring failure at the mean value of x (temperature). And add confidence intervals!</p>
<p>But how do log-odds and probability actually relate?</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">emmeans</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">binary_model</span>, specs<span class="op">=</span><span class="op">~</span><span class="va">temp</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></code></pre></div>
<pre><code>##  temp prob     SE  df asymp.LCL asymp.UCL
##  69.6 0.15 0.0985 Inf    0.0373     0.445
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the logit scale</code></pre>
<p>This is the equation to work out probability using the <strong>exponent</strong> of the linear regression equation:</p>
<p><span class="math display">\[
P(\operatorname{risk of failure at }  X=69)\left[ \frac{e^{23.77+(-0.37 \times 69.6)}}{1+e^{23.77+(-0.37 \times 69.6)}} \right]
\]</span></p>
<p>Which produces the following result and we can confirm the risk of an o-ring failure on an <em>average</em> day is 0.15</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">odds_at_69.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">binary_model</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">binary_model</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">69.6</span><span class="op">)</span>
<span class="co"># To convert from odds to a probability, divide the odds by one plus the odds</span>

<span class="va">probability</span> <span class="op">&lt;-</span>  <span class="va">odds_at_69.6</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">odds_at_69.6</span><span class="op">)</span>
<span class="va">probability</span></code></pre></div>
<pre><code>## (Intercept) 
##   0.1483717</code></pre>
</div>
<div id="changes-in-probability" class="section level3" number="19.10.3">
<h3>
<span class="header-section-number">19.10.3</span> Changes in probability<a class="anchor" aria-label="anchor" href="#changes-in-probability"><i class="fas fa-link"></i></a>
</h3>
<p>A useful <em>rule-of-thumb</em> can be the <strong>divide-by-four</strong> rule.</p>
<p>This can be described as the <strong>maximum</strong> difference in probability for a unit change in <span class="math inline">\(X\)</span> is <span class="math inline">\(\beta/4\)</span>.</p>
<p>In our example the <strong>maximum difference</strong> in probability from a one degree change in Temp is <span class="math inline">\(-0.37/4 = -0.09\)</span></p>
<p>So the <strong>maximum difference</strong> in probability of failure corresponding to a one degree change is 9%</p>
<p>Remember if you want to augment your data with the model, you can use the <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code> function, remembering to specify <code>type.predict = "response</code> to get probabilities of o-ring failure (not log odds).</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">binary_model</span>, 
               type.predict<span class="op">=</span><span class="st">"response"</span>, 
               se_fit <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
oring_binary
</th>
<th style="text-align:right;">
temp
</th>
<th style="text-align:right;">
.fitted
</th>
<th style="text-align:right;">
.se.fit
</th>
<th style="text-align:right;">
.resid
</th>
<th style="text-align:right;">
.std.resid
</th>
<th style="text-align:right;">
.hat
</th>
<th style="text-align:right;">
.sigma
</th>
<th style="text-align:right;">
.cooksd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
0.3947697
</td>
<td style="text-align:right;">
0.1701810
</td>
<td style="text-align:right;">
-1.0021439
</td>
<td style="text-align:right;">
-1.0690274
</td>
<td style="text-align:right;">
0.1212153
</td>
<td style="text-align:right;">
0.8149531
</td>
<td style="text-align:right;">
0.0511900
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
0.0924586
</td>
<td style="text-align:right;">
2.0170599
</td>
<td style="text-align:right;">
2.0974690
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.7080401
</td>
<td style="text-align:right;">
0.2922222
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.1783731
</td>
<td style="text-align:right;">
0.1067906
</td>
<td style="text-align:right;">
-0.6268474
</td>
<td style="text-align:right;">
-0.6527589
</td>
<td style="text-align:right;">
0.0778149
</td>
<td style="text-align:right;">
0.8366510
</td>
<td style="text-align:right;">
0.0099323
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
0.2385386
</td>
<td style="text-align:right;">
0.1234222
</td>
<td style="text-align:right;">
-0.7382625
</td>
<td style="text-align:right;">
-0.7713137
</td>
<td style="text-align:right;">
0.0838649
</td>
<td style="text-align:right;">
0.8315908
</td>
<td style="text-align:right;">
0.0156510
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
0.1444333
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
0.0673886
</td>
<td style="text-align:right;">
0.0661208
</td>
<td style="text-align:right;">
-0.3735417
</td>
<td style="text-align:right;">
-0.3872542
</td>
<td style="text-align:right;">
0.0695651
</td>
<td style="text-align:right;">
0.8448617
</td>
<td style="text-align:right;">
0.0029032
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Annoyingly a limitation of the augment function is that it won't produce 95% CI for predictions on glms. But I have written a short function to do this
Don't worry if this is a lot to get your head around - the main thing is use this code to produce 95% CI.</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">augment_glm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">predict</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="va">fam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">family</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
  <span class="va">ilink</span> <span class="op">&lt;-</span> <span class="va">fam</span><span class="op">$</span><span class="va">linkinv</span>
  
  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">predict</span>, se_fit<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>.lower <span class="op">=</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">.fitted</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">.se.fit</span><span class="op">)</span>,
           .upper <span class="op">=</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">.fitted</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">.se.fit</span><span class="op">)</span>, 
           .fitted<span class="op">=</span><span class="fu">ilink</span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">augment_glm</span><span class="op">(</span><span class="va">binary_model</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
oring_binary
</th>
<th style="text-align:right;">
temp
</th>
<th style="text-align:right;">
.fitted
</th>
<th style="text-align:right;">
.se.fit
</th>
<th style="text-align:right;">
.resid
</th>
<th style="text-align:right;">
.std.resid
</th>
<th style="text-align:right;">
.hat
</th>
<th style="text-align:right;">
.sigma
</th>
<th style="text-align:right;">
.cooksd
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
0.3947697
</td>
<td style="text-align:right;">
0.7122731
</td>
<td style="text-align:right;">
-1.0021439
</td>
<td style="text-align:right;">
-1.0690274
</td>
<td style="text-align:right;">
0.1212153
</td>
<td style="text-align:right;">
0.8149531
</td>
<td style="text-align:right;">
0.0511900
</td>
<td style="text-align:right;">
0.1390310
</td>
<td style="text-align:right;">
0.7248700
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
0.8133661
</td>
<td style="text-align:right;">
2.0170599
</td>
<td style="text-align:right;">
2.0974690
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.7080401
</td>
<td style="text-align:right;">
0.2922222
</td>
<td style="text-align:right;">
0.0296467
</td>
<td style="text-align:right;">
0.4255788
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.1783731
</td>
<td style="text-align:right;">
0.7286671
</td>
<td style="text-align:right;">
-0.6268474
</td>
<td style="text-align:right;">
-0.6527589
</td>
<td style="text-align:right;">
0.0778149
</td>
<td style="text-align:right;">
0.8366510
</td>
<td style="text-align:right;">
0.0099323
</td>
<td style="text-align:right;">
0.0494727
</td>
<td style="text-align:right;">
0.4752149
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
0.2385386
</td>
<td style="text-align:right;">
0.6794956
</td>
<td style="text-align:right;">
-0.7382625
</td>
<td style="text-align:right;">
-0.7713137
</td>
<td style="text-align:right;">
0.0838649
</td>
<td style="text-align:right;">
0.8315908
</td>
<td style="text-align:right;">
0.0156510
</td>
<td style="text-align:right;">
0.0763842
</td>
<td style="text-align:right;">
0.5426717
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
0.6736765
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
<td style="text-align:right;">
0.1077038
</td>
<td style="text-align:right;">
0.6286427
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
0.0673886
</td>
<td style="text-align:right;">
1.0520852
</td>
<td style="text-align:right;">
-0.3735417
</td>
<td style="text-align:right;">
-0.3872542
</td>
<td style="text-align:right;">
0.0695651
</td>
<td style="text-align:right;">
0.8448617
</td>
<td style="text-align:right;">
0.0029032
</td>
<td style="text-align:right;">
0.0091067
</td>
<td style="text-align:right;">
0.3622931
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0.0476880
</td>
<td style="text-align:right;">
1.1923059
</td>
<td style="text-align:right;">
-0.3126102
</td>
<td style="text-align:right;">
-0.3232178
</td>
<td style="text-align:right;">
0.0645605
</td>
<td style="text-align:right;">
0.8462069
</td>
<td style="text-align:right;">
0.0018473
</td>
<td style="text-align:right;">
0.0048153
</td>
<td style="text-align:right;">
0.3413479
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
0.8133661
</td>
<td style="text-align:right;">
-0.5294432
</td>
<td style="text-align:right;">
-0.5505492
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.8403180
</td>
<td style="text-align:right;">
0.0066147
</td>
<td style="text-align:right;">
0.0296467
</td>
<td style="text-align:right;">
0.4255788
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.9464956
</td>
<td style="text-align:right;">
1.9365672
</td>
<td style="text-align:right;">
0.3316293
</td>
<td style="text-align:right;">
0.3684596
</td>
<td style="text-align:right;">
0.1899238
</td>
<td style="text-align:right;">
0.8452819
</td>
<td style="text-align:right;">
0.0081803
</td>
<td style="text-align:right;">
0.2844142
</td>
<td style="text-align:right;">
0.9987315
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0.6621290
</td>
<td style="text-align:right;">
1.0178481
</td>
<td style="text-align:right;">
0.9080692
</td>
<td style="text-align:right;">
1.0360335
</td>
<td style="text-align:right;">
0.2317717
</td>
<td style="text-align:right;">
0.8170810
</td>
<td style="text-align:right;">
0.1001978
</td>
<td style="text-align:right;">
0.2104548
</td>
<td style="text-align:right;">
0.9350983
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
0.8133661
</td>
<td style="text-align:right;">
2.0170599
</td>
<td style="text-align:right;">
2.0974690
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.7080401
</td>
<td style="text-align:right;">
0.2922222
</td>
<td style="text-align:right;">
0.0296467
</td>
<td style="text-align:right;">
0.4255788
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
0.0079412
</td>
<td style="text-align:right;">
1.9788007
</td>
<td style="text-align:right;">
-0.1262767
</td>
<td style="text-align:right;">
-0.1282707
</td>
<td style="text-align:right;">
0.0308485
</td>
<td style="text-align:right;">
0.8488032
</td>
<td style="text-align:right;">
0.0001315
</td>
<td style="text-align:right;">
0.0001655
</td>
<td style="text-align:right;">
0.2790320
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
0.6736765
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
<td style="text-align:right;">
0.1077038
</td>
<td style="text-align:right;">
0.6286427
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
0.9871288
</td>
<td style="text-align:right;">
2.6052168
</td>
<td style="text-align:right;">
0.1609645
</td>
<td style="text-align:right;">
0.1683888
</td>
<td style="text-align:right;">
0.0862364
</td>
<td style="text-align:right;">
0.8484526
</td>
<td style="text-align:right;">
0.0006733
</td>
<td style="text-align:right;">
0.3172542
</td>
<td style="text-align:right;">
0.9999210
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0.3113088
</td>
<td style="text-align:right;">
0.6736765
</td>
<td style="text-align:right;">
-0.8636693
</td>
<td style="text-align:right;">
-0.9090255
</td>
<td style="text-align:right;">
0.0973013
</td>
<td style="text-align:right;">
0.8246049
</td>
<td style="text-align:right;">
0.0269880
</td>
<td style="text-align:right;">
0.1077038
</td>
<td style="text-align:right;">
0.6286427
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0.0234853
</td>
<td style="text-align:right;">
1.4950302
</td>
<td style="text-align:right;">
-0.2180160
</td>
<td style="text-align:right;">
-0.2238281
</td>
<td style="text-align:right;">
0.0512601
</td>
<td style="text-align:right;">
0.8478117
</td>
<td style="text-align:right;">
0.0006848
</td>
<td style="text-align:right;">
0.0012822
</td>
<td style="text-align:right;">
0.3105914
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.1307765
</td>
<td style="text-align:right;">
0.8133661
</td>
<td style="text-align:right;">
-0.5294432
</td>
<td style="text-align:right;">
-0.5505492
</td>
<td style="text-align:right;">
0.0752029
</td>
<td style="text-align:right;">
0.8403180
</td>
<td style="text-align:right;">
0.0066147
</td>
<td style="text-align:right;">
0.0296467
</td>
<td style="text-align:right;">
0.4255788
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
0.0026572
</td>
<td style="text-align:right;">
2.4796156
</td>
<td style="text-align:right;">
-0.0729485
</td>
<td style="text-align:right;">
-0.0735502
</td>
<td style="text-align:right;">
0.0162947
</td>
<td style="text-align:right;">
0.8491284
</td>
<td style="text-align:right;">
0.0000224
</td>
<td style="text-align:right;">
0.0000206
</td>
<td style="text-align:right;">
0.2558266
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.0163939
</td>
<td style="text-align:right;">
1.6534591
</td>
<td style="text-align:right;">
-0.1818228
</td>
<td style="text-align:right;">
-0.1859683
</td>
<td style="text-align:right;">
0.0440855
</td>
<td style="text-align:right;">
0.8482690
</td>
<td style="text-align:right;">
0.0004021
</td>
<td style="text-align:right;">
0.0006518
</td>
<td style="text-align:right;">
0.2986916
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
0.0055168
</td>
<td style="text-align:right;">
2.1444266
</td>
<td style="text-align:right;">
-0.1051866
</td>
<td style="text-align:right;">
-0.1065392
</td>
<td style="text-align:right;">
0.0252300
</td>
<td style="text-align:right;">
0.8489535
</td>
<td style="text-align:right;">
0.0000737
</td>
<td style="text-align:right;">
0.0000829
</td>
<td style="text-align:right;">
0.2706470
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0.0234853
</td>
<td style="text-align:right;">
1.4950302
</td>
<td style="text-align:right;">
-0.2180160
</td>
<td style="text-align:right;">
-0.2238281
</td>
<td style="text-align:right;">
0.0512601
</td>
<td style="text-align:right;">
0.8478117
</td>
<td style="text-align:right;">
0.0006848
</td>
<td style="text-align:right;">
0.0012822
</td>
<td style="text-align:right;">
0.3105914
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.0163939
</td>
<td style="text-align:right;">
1.6534591
</td>
<td style="text-align:right;">
-0.1818228
</td>
<td style="text-align:right;">
-0.1859683
</td>
<td style="text-align:right;">
0.0440855
</td>
<td style="text-align:right;">
0.8482690
</td>
<td style="text-align:right;">
0.0004021
</td>
<td style="text-align:right;">
0.0006518
</td>
<td style="text-align:right;">
0.2986916
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
0.9245824
</td>
<td style="text-align:right;">
1.7732723
</td>
<td style="text-align:right;">
0.3960130
</td>
<td style="text-align:right;">
0.4481860
</td>
<td style="text-align:right;">
0.2192676
</td>
<td style="text-align:right;">
0.8433540
</td>
<td style="text-align:right;">
0.0146713
</td>
<td style="text-align:right;">
0.2750175
</td>
<td style="text-align:right;">
0.9974824
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Alternatively we can also do this calculation via emmeans</p>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">emmeans</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">binary_model</span>, 
                 specs <span class="op">=</span> <span class="op">~</span> <span class="va">temp</span>, 
                 at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>temp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">66</span><span class="op">:</span><span class="fl">27</span><span class="op">)</span><span class="op">)</span>, 
                 type<span class="op">=</span><span class="st">'response'</span><span class="op">)</span> </code></pre></div>
<pre><code>##  temp     prob         SE  df asymp.LCL asymp.UCL
##    66 0.394770 0.17018097 Inf  0.139034  0.724865
##    65 0.484853 0.19701707 Inf  0.167060  0.815387
##    64 0.575932 0.21823406 Inf  0.190739  0.886694
##    63 0.662129 0.22770706 Inf  0.210461  0.935096
##    62 0.738753 0.22299102 Inf  0.227046  0.964568
##    61 0.803166 0.20584013 Inf  0.241266  0.981259
##    60 0.854818 0.18057075 Inf  0.253727  0.990288
##    59 0.894693 0.15192302 Inf  0.264874  0.995033
##    58 0.924582 0.12364996 Inf  0.275030  0.997482
##    57 0.946496 0.09807106 Inf  0.284428  0.998731
##    56 0.962301 0.07624709 Inf  0.293240  0.999364
##    55 0.973568 0.05837488 Inf  0.301592  0.999682
##    54 0.981533 0.04416262 Inf  0.309579  0.999841
##    53 0.987129 0.03310075 Inf  0.317275  0.999921
##    52 0.991045 0.02462725 Inf  0.324734  0.999961
##    51 0.993777 0.01821445 Inf  0.332003  0.999981
##    50 0.995679 0.01340624 Inf  0.339114  0.999990
##    49 0.997001 0.00982751 Inf  0.346096  0.999995
##    48 0.997920 0.00717951 Inf  0.352970  0.999998
##    47 0.998558 0.00522962 Inf  0.359755  0.999999
##    46 0.999000 0.00379955 Inf  0.366464  0.999999
##    45 0.999307 0.00275431 Inf  0.373111  1.000000
##    44 0.999520 0.00199257 Inf  0.379705  1.000000
##    43 0.999667 0.00143888 Inf  0.386253  1.000000
##    42 0.999769 0.00103733 Inf  0.392763  1.000000
##    41 0.999840 0.00074671 Inf  0.399239  1.000000
##    40 0.999889 0.00053676 Inf  0.405687  1.000000
##    39 0.999923 0.00038534 Inf  0.412110  1.000000
##    38 0.999947 0.00027631 Inf  0.418510  1.000000
##    37 0.999963 0.00019791 Inf  0.424891  1.000000
##    36 0.999974 0.00014160 Inf  0.431253  1.000000
##    35 0.999982 0.00010122 Inf  0.437600  1.000000
##    34 0.999988 0.00007228 Inf  0.443931  1.000000
##    33 0.999992 0.00005158 Inf  0.450247  1.000000
##    32 0.999994 0.00003677 Inf  0.456549  1.000000
##    31 0.999996 0.00002619 Inf  0.462837  1.000000
##    30 0.999997 0.00001865 Inf  0.469112  1.000000
##    29 0.999998 0.00001327 Inf  0.475372  1.000000
##    28 0.999999 0.00000943 Inf  0.481619  1.000000
##    27 0.999999 0.00000670 Inf  0.487850  1.000000
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the logit scale</code></pre>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Use the augment_glm function to make a ggplot of the changing probability of O-ring failure with temperature
</div>
</div>
<button id="displayTextunnamed-chunk-51" onclick="javascript:toggle('unnamed-chunk-51');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-51" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment_glm</span><span class="op">(</span><span class="va">binary_model</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">temp</span>, y<span class="op">=</span><span class="va">oring_binary</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">temp</span>, y<span class="op">=</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">.lower</span>, ymax<span class="op">=</span><span class="va">.upper</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-61-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
</div>
</div>
</div>
<div id="predictions" class="section level2" number="19.11">
<h2>
<span class="header-section-number">19.11</span> Predictions<a class="anchor" aria-label="anchor" href="#predictions"><i class="fas fa-link"></i></a>
</h2>
<p>On the day the Challenger launched the outside air temperature was 36°F</p>
<p>We can use augment to add our model to new data - and make predictions about the risk of o-ring failure</p>
<div id="activity-4-more-predictions" class="section level3" number="19.11.1">
<h3>
<span class="header-section-number">19.11.1</span> Activity 4: More predictions<a class="anchor" aria-label="anchor" href="#activity-4-more-predictions"><i class="fas fa-link"></i></a>
</h3>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Make a new dataset with the temperature on the day of the Challenger launch - what was the probability of o-ring failure?
</div>
</div>
<button id="displayTextunnamed-chunk-53" onclick="javascript:toggle('unnamed-chunk-53');">
Show Solution
</button>
<div id="toggleTextunnamed-chunk-53" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<p>First - we make a new dataset with the temperature on the day of the Challenger Launch <strong>36°F</strong></p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>temp<span class="op">=</span><span class="fl">36</span>, oring_binary<span class="op">=</span><span class="fl">1</span><span class="op">)</span>


<span class="fu">augment_glm</span><span class="op">(</span><span class="va">binary_model</span>, <span class="va">new_data</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
temp
</th>
<th style="text-align:right;">
oring_binary
</th>
<th style="text-align:right;">
.fitted
</th>
<th style="text-align:right;">
.se.fit
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9999744
</td>
<td style="text-align:right;">
5.536051
</td>
<td style="text-align:right;">
0.4312045
</td>
<td style="text-align:right;">
1
</td>
</tr></tbody>
</table></div>
</div>
<p>We can see from our fitted model, an O-ring failure on the day of the Challenger launch could have been predicted with a probability of &gt;0.999 [95%CI: 0.43-1]</p>
</div>
</div>
</div>
</div>
</div>
<div id="assumptions-1" class="section level2" number="19.12">
<h2>
<span class="header-section-number">19.12</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-1"><i class="fas fa-link"></i></a>
</h2>
<p>The standard model checks from <code><a href="https://www.danieldsjoberg.com/gtsummary/reference/plot.html">plot()</a></code> cannot be used on binomial glms, they are usually a mess!</p>
<p>Luckily the <code>performance</code> package detects and alters the checks. Pay particular attention to the binned residuals plot - this is your best estimate of possible overdispersion (requiring a quasi-likelihood check). In this case there is likely not enough data for robust checks</p>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">binary_model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="19-Generalized-Linear-Models_files/figure-html/unnamed-chunk-54-1.png" width="100%" style="display: block; margin: auto;"></div>
<div id="activity-5-write-up" class="section level3" number="19.12.1">
<h3>
<span class="header-section-number">19.12.1</span> Activity 5: Write-up<a class="anchor" aria-label="anchor" href="#activity-5-write-up"><i class="fas fa-link"></i></a>
</h3>
<p>How would you write up for findings from this analysis?</p>
<div class="webex-solution">
<button>
Write-up
</button>
<p>Analysis: I used a Binomial logit-link Generalized Linear Model to analyse the effect of temperature on the likelihood of O-ring failure.</p>
<p>All analyses were carried out in R (ver 4.1.3) (R Core Team 2021) with the following packages; tidyverse (Wickham et al 2019).</p>
<p>Results: I found a significant negative relationship between temperature and probability of o-ring failure (logit-odds = -0.37 [95%CI: -0.88 - -0.12], <em>z</em> = -2.1, d.f = 21, <em>P</em> = 0.036). At an average temperature of 69.6°F the probability of o-ring failure was estimated at 0.15[0.03-0.45], but this rose to a near certainty of failure 0.99[0.43-1] at 36°F.</p>
<blockquote>
<p>Note you could use drop1( test = "Chisq") here, but as there is only one, continuous variable, we can also report directly from the summary table.</p>
</blockquote>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/add1.html">drop1</a></span><span class="op">(</span><span class="va">binary_model</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Df
</th>
<th style="text-align:right;">
Deviance
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
LRT
</th>
<th style="text-align:right;">
Pr(&gt;Chi)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
&lt;none&gt;
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
14.42579
</td>
<td style="text-align:right;">
18.42579
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
temp
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
26.40237
</td>
<td style="text-align:right;">
28.40237
</td>
<td style="text-align:right;">
11.97658
</td>
<td style="text-align:right;">
0.0005387
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>
<div id="summary-9" class="section level2" number="19.13">
<h2>
<span class="header-section-number">19.13</span> Summary<a class="anchor" aria-label="anchor" href="#summary-9"><i class="fas fa-link"></i></a>
</h2>
<p><strong>GLMs</strong> are powerful and flexible.</p>
<p>They can be used to fit a wide variety of data types.</p>
<p>Model checking becomes trickier.</p>
<p>Extensions include:</p>
<ul>
<li>
<strong>mixed models</strong>;</li>
<li>
<strong>survival models</strong>;</li>
<li>
<strong>generalized additive models</strong> (GAMs).</li>
</ul>
<p>For more information on Poisson and Binomial GLMs check out:</p>
<p><a href="https://bookdown.org/dereksonderegger/571/11-binomial-regression.html#confidence-intervals-1" class="uri">https://bookdown.org/dereksonderegger/571/11-binomial-regression.html#confidence-intervals-1</a></p>
<p><a href="https://bookdown.org/ronsarafian/IntrotoDS/glm.html#poisson-regression" class="uri">https://bookdown.org/ronsarafian/IntrotoDS/glm.html#poisson-regression</a></p>
</div>
<div id="final-checklist" class="section level2" number="19.14">
<h2>
<span class="header-section-number">19.14</span> Final checklist<a class="anchor" aria-label="anchor" href="#final-checklist"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Think carefully about the hypotheses to test, use your scientific knowledge and background reading to support this</p></li>
<li><p>Import, clean and understand your dataset: use data visuals to investigate trends and determine if there is clear support for your hypotheses</p></li>
<li><p><strong>Decide on the appropriate error structure for your model (Gaussian = continuous, Poisson = count, Binomial = binary)</strong></p></li>
<li><p><strong>Start with canonical link functions, but these can be altered if needed</strong></p></li>
<li><p>Fit a (generalized) linear model, including interaction terms with caution</p></li>
<li><p>Investigate the fit of your model, understand that parameters may never be perfect, but that classic patterns in residuals may indicate a poorly fitting model - sometimes this can be fixed with careful consideration of missing variables or through data transformation</p></li>
<li><p><strong>Check for overdispersion in models where variance is not estimated independently of the mean (Poisson and Binomial) - may have to use quasi-likelihood fitting</strong></p></li>
<li><p>Test the removal of any interaction terms from a model, look at AIC and significance tests (Remember test = "F" for Gaussian and Quasilikelihood models, "Chisq" for Poisson and Binomial models)</p></li>
<li><p>Make sure you understand the output of a model summary, sense check this against the graphs you have made - Do estimates need converting back to the original response scale?</p></li>
<li><p>The direction and size of any effects are the priority - produce estimates and uncertainties. Make sure the observations are clear.</p></li>
<li><p>Write-up your significance test results, taking care to report not just significance (and all required parts of a significance test). Do you know <em>what</em> to report? Within a complex model - reporting <em>t/z</em> will indicate the slope of the line for that single term against the intercept, <em>F/Chi</em> is the overall effect of a predictor across all levels, <em>post-hoc</em> if you wish to compare across all levels.</p></li>
<li><p>Well described tables and figures can enhance your results sections - take the time to make sure these are informative and attractive.</p></li>
</ul>
</div>
</div>



<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="complex-models.html"><span class="header-section-number">18</span> Complex models</a></div>
<div class="next"><a href="mixed-models.html"><span class="header-section-number">20</span> Mixed models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#generalized-linear-models"><span class="header-section-number">19</span> Generalized Linear Models</a></li>
<li><a class="nav-link" href="#motivation"><span class="header-section-number">19.1</span> Motivation</a></li>
<li><a class="nav-link" href="#generalised-linear-models-glms"><span class="header-section-number">19.2</span> Generalised Linear Models (GLMs)</a></li>
<li><a class="nav-link" href="#workflow-for-fitting-a-glm"><span class="header-section-number">19.3</span> Workflow for fitting a GLM</a></li>
<li><a class="nav-link" href="#poisson-regression-for-count-data-or-rate-data"><span class="header-section-number">19.4</span> Poisson regression (for count data or rate data)</a></li>
<li>
<a class="nav-link" href="#example-cuckoos"><span class="header-section-number">19.5</span> Example: Cuckoos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#variable-scale"><span class="header-section-number">19.5.1</span> Variable scale</a></li>
<li><a class="nav-link" href="#log-scale"><span class="header-section-number">19.5.2</span> Log scale</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#estimates-and-intervals"><span class="header-section-number">19.6</span> Estimates and Intervals</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#interpretation"><span class="header-section-number">19.6.1</span> Interpretation</a></li></ul>
</li>
<li><a class="nav-link" href="#overdispersion"><span class="header-section-number">19.7</span> Overdispersion</a></li>
<li><a class="nav-link" href="#activity-2-write-up"><span class="header-section-number">19.8</span> Activity 2: Write-up</a></li>
<li>
<a class="nav-link" href="#logistic-regression-for-binary-data"><span class="header-section-number">19.9</span> Logistic regression (for binary data)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#interpreting-model-coefficients"><span class="header-section-number">19.9.1</span> Interpreting model coefficients</a></li></ul>
</li>
<li>
<a class="nav-link" href="#probability"><span class="header-section-number">19.10</span> Probability</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#activity-3-make-predictions"><span class="header-section-number">19.10.1</span> Activity 3: Make predictions</a></li>
<li><a class="nav-link" href="#emmeans-1"><span class="header-section-number">19.10.2</span> Emmeans</a></li>
<li><a class="nav-link" href="#changes-in-probability"><span class="header-section-number">19.10.3</span> Changes in probability</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#predictions"><span class="header-section-number">19.11</span> Predictions</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#activity-4-more-predictions"><span class="header-section-number">19.11.1</span> Activity 4: More predictions</a></li></ul>
</li>
<li>
<a class="nav-link" href="#assumptions-1"><span class="header-section-number">19.12</span> Assumptions</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#activity-5-write-up"><span class="header-section-number">19.12.1</span> Activity 5: Write-up</a></li></ul>
</li>
<li><a class="nav-link" href="#summary-9"><span class="header-section-number">19.13</span> Summary</a></li>
<li><a class="nav-link" href="#final-checklist"><span class="header-section-number">19.14</span> Final checklist</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/UEABIO/data-sci-v1/blob/main/book/19-Generalized-Linear-Models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/UEABIO/data-sci-v1/edit/main/book/19-Generalized-Linear-Models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>5023Y</strong>: Data Science for Biologists" was written by Philip T. Leftwich. It was last built on 2023-03-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
